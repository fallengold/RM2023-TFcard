ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"user_diskio_spi.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.xchg_spi,"ax",%progbits
  18              		.align	1
  19              		.arch armv7e-m
  20              		.syntax unified
  21              		.thumb
  22              		.thumb_func
  23              		.fpu fpv4-sp-d16
  25              	xchg_spi:
  26              	.LVL0:
  27              	.LFB134:
  28              		.file 1 "FATFS/Target/user_diskio_spi.c"
   1:FATFS/Target/user_diskio_spi.c **** /**
   2:FATFS/Target/user_diskio_spi.c ****  ******************************************************************************
   3:FATFS/Target/user_diskio_spi.c ****  * @file    user_diskio_spi.c
   4:FATFS/Target/user_diskio_spi.c ****  * @brief   This file contains the implementation of the user_diskio_spi FatFs
   5:FATFS/Target/user_diskio_spi.c ****  *          driver.
   6:FATFS/Target/user_diskio_spi.c ****  ******************************************************************************
   7:FATFS/Target/user_diskio_spi.c ****  * Portions copyright (C) 2014, ChaN, all rights reserved.
   8:FATFS/Target/user_diskio_spi.c ****  * Portions copyright (C) 2017, kiwih, all rights reserved.
   9:FATFS/Target/user_diskio_spi.c ****  *
  10:FATFS/Target/user_diskio_spi.c ****  * This software is a free software and there is NO WARRANTY.
  11:FATFS/Target/user_diskio_spi.c ****  * No restriction on use. You can use, modify and redistribute it for
  12:FATFS/Target/user_diskio_spi.c ****  * personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
  13:FATFS/Target/user_diskio_spi.c ****  * Redistributions of source code must retain the above copyright notice.
  14:FATFS/Target/user_diskio_spi.c ****  *
  15:FATFS/Target/user_diskio_spi.c ****  ******************************************************************************
  16:FATFS/Target/user_diskio_spi.c ****  */
  17:FATFS/Target/user_diskio_spi.c **** 
  18:FATFS/Target/user_diskio_spi.c **** // This code was ported by kiwih from a copywrited (C) library written by ChaN
  19:FATFS/Target/user_diskio_spi.c **** // available at http://elm-chan.org/fsw/ff/ffsample.zip
  20:FATFS/Target/user_diskio_spi.c **** //(text at http://elm-chan.org/fsw/ff/00index_e.html)
  21:FATFS/Target/user_diskio_spi.c **** 
  22:FATFS/Target/user_diskio_spi.c **** // This file provides the FatFs driver functions and SPI code required to manage
  23:FATFS/Target/user_diskio_spi.c **** // an SPI-connected MMC or compatible SD card with FAT
  24:FATFS/Target/user_diskio_spi.c **** 
  25:FATFS/Target/user_diskio_spi.c **** // It is designed to be wrapped by a cubemx generated user_diskio.c file.
  26:FATFS/Target/user_diskio_spi.c **** 
  27:FATFS/Target/user_diskio_spi.c **** #include "stm32g4xx_hal.h" /* Provide the low-level HAL functions */
  28:FATFS/Target/user_diskio_spi.c **** #include "user_diskio_spi.h"
  29:FATFS/Target/user_diskio_spi.c **** 
  30:FATFS/Target/user_diskio_spi.c **** // Make sure you set #define SD_SPI_HANDLE as some hspix in main.h
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 2


  31:FATFS/Target/user_diskio_spi.c **** // Make sure you set #define SD_CS_GPIO_Port as some GPIO port in main.h
  32:FATFS/Target/user_diskio_spi.c **** // Make sure you set #define SD_CS_Pin as some GPIO pin in main.h
  33:FATFS/Target/user_diskio_spi.c **** extern SPI_HandleTypeDef SD_SPI_HANDLE;
  34:FATFS/Target/user_diskio_spi.c **** 
  35:FATFS/Target/user_diskio_spi.c **** /* Function prototypes */
  36:FATFS/Target/user_diskio_spi.c **** 
  37:FATFS/Target/user_diskio_spi.c **** //(Note that the _256 is used as a mask to clear the prescalar bits as it provides binary 111 in th
  38:FATFS/Target/user_diskio_spi.c **** #define FCLK_SLOW()                                                                                
  39:FATFS/Target/user_diskio_spi.c **** 	{                                                                                                 
  40:FATFS/Target/user_diskio_spi.c **** 		MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRATEPRESCALER_128); \
  41:FATFS/Target/user_diskio_spi.c **** 	} /* Set SCLK = slow, approx 280 KBits/s*/
  42:FATFS/Target/user_diskio_spi.c **** #define FCLK_FAST()                                                                                
  43:FATFS/Target/user_diskio_spi.c **** 	{                                                                                                \
  44:FATFS/Target/user_diskio_spi.c **** 		MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRATEPRESCALER_8); \
  45:FATFS/Target/user_diskio_spi.c **** 	} /* Set SCLK = fast, approx 4.5 MBits/s */
  46:FATFS/Target/user_diskio_spi.c **** 
  47:FATFS/Target/user_diskio_spi.c **** #define CS_HIGH()                                                    \
  48:FATFS/Target/user_diskio_spi.c **** 	{                                                                \
  49:FATFS/Target/user_diskio_spi.c **** 		HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_SET); \
  50:FATFS/Target/user_diskio_spi.c **** 	}
  51:FATFS/Target/user_diskio_spi.c **** #define CS_LOW()                                                       \
  52:FATFS/Target/user_diskio_spi.c **** 	{                                                                  \
  53:FATFS/Target/user_diskio_spi.c **** 		HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_RESET); \
  54:FATFS/Target/user_diskio_spi.c **** 	}
  55:FATFS/Target/user_diskio_spi.c **** 
  56:FATFS/Target/user_diskio_spi.c **** /*--------------------------------------------------------------------------
  57:FATFS/Target/user_diskio_spi.c **** 
  58:FATFS/Target/user_diskio_spi.c ****    Module Private Functions
  59:FATFS/Target/user_diskio_spi.c **** 
  60:FATFS/Target/user_diskio_spi.c **** ---------------------------------------------------------------------------*/
  61:FATFS/Target/user_diskio_spi.c **** 
  62:FATFS/Target/user_diskio_spi.c **** /* MMC/SD command */
  63:FATFS/Target/user_diskio_spi.c **** #define CMD0 (0)		   /* GO_IDLE_STATE */
  64:FATFS/Target/user_diskio_spi.c **** #define CMD1 (1)		   /* SEND_OP_COND (MMC) */
  65:FATFS/Target/user_diskio_spi.c **** #define ACMD41 (0x80 + 41) /* SEND_OP_COND (SDC) */
  66:FATFS/Target/user_diskio_spi.c **** #define CMD8 (8)		   /* SEND_IF_COND */
  67:FATFS/Target/user_diskio_spi.c **** #define CMD9 (9)		   /* SEND_CSD */
  68:FATFS/Target/user_diskio_spi.c **** #define CMD10 (10)		   /* SEND_CID */
  69:FATFS/Target/user_diskio_spi.c **** #define CMD12 (12)		   /* STOP_TRANSMISSION */
  70:FATFS/Target/user_diskio_spi.c **** #define CMD13 (13)
  71:FATFS/Target/user_diskio_spi.c **** #define ACMD13 (0x80 + 13) /* SD_STATUS (SDC) */
  72:FATFS/Target/user_diskio_spi.c **** #define CMD16 (16)		   /* SET_BLOCKLEN */
  73:FATFS/Target/user_diskio_spi.c **** #define CMD17 (17)		   /* READ_SINGLE_BLOCK */
  74:FATFS/Target/user_diskio_spi.c **** #define CMD18 (18)		   /* READ_MULTIPLE_BLOCK */
  75:FATFS/Target/user_diskio_spi.c **** #define CMD23 (23)		   /* SET_BLOCK_COUNT (MMC) */
  76:FATFS/Target/user_diskio_spi.c **** #define ACMD23 (0x80 + 23) /* SET_WR_BLK_ERASE_COUNT (SDC) */
  77:FATFS/Target/user_diskio_spi.c **** #define CMD24 (24)		   /* WRITE_BLOCK */
  78:FATFS/Target/user_diskio_spi.c **** #define CMD25 (25)		   /* WRITE_MULTIPLE_BLOCK */
  79:FATFS/Target/user_diskio_spi.c **** #define CMD32 (32)		   /* ERASE_ER_BLK_START */
  80:FATFS/Target/user_diskio_spi.c **** #define CMD33 (33)		   /* ERASE_ER_BLK_END */
  81:FATFS/Target/user_diskio_spi.c **** #define CMD38 (38)		   /* ERASE */
  82:FATFS/Target/user_diskio_spi.c **** #define CMD55 (55)		   /* APP_CMD */
  83:FATFS/Target/user_diskio_spi.c **** #define CMD58 (58)		   /* READ_OCR */
  84:FATFS/Target/user_diskio_spi.c **** 
  85:FATFS/Target/user_diskio_spi.c **** /* MMC card type flags (MMC_GET_TYPE) */
  86:FATFS/Target/user_diskio_spi.c **** #define CT_MMC 0x01				 /* MMC ver 3 */
  87:FATFS/Target/user_diskio_spi.c **** #define CT_SD1 0x02				 /* SD ver 1 */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 3


  88:FATFS/Target/user_diskio_spi.c **** #define CT_SD2 0x04				 /* SD ver 2 */
  89:FATFS/Target/user_diskio_spi.c **** #define CT_SDC (CT_SD1 | CT_SD2) /* SD */
  90:FATFS/Target/user_diskio_spi.c **** #define CT_BLOCK 0x08			 /* Block addressing */
  91:FATFS/Target/user_diskio_spi.c **** 
  92:FATFS/Target/user_diskio_spi.c **** static volatile DSTATUS Stat = STA_NOINIT; /* Physical drive status */
  93:FATFS/Target/user_diskio_spi.c **** 
  94:FATFS/Target/user_diskio_spi.c **** static BYTE CardType; /* Card type flags */
  95:FATFS/Target/user_diskio_spi.c **** 
  96:FATFS/Target/user_diskio_spi.c **** uint32_t spiTimerTickStart;
  97:FATFS/Target/user_diskio_spi.c **** uint32_t spiTimerTickDelay;
  98:FATFS/Target/user_diskio_spi.c **** 
  99:FATFS/Target/user_diskio_spi.c **** void SPI_Timer_On(uint32_t waitTicks)
 100:FATFS/Target/user_diskio_spi.c **** {
 101:FATFS/Target/user_diskio_spi.c **** 	spiTimerTickStart = HAL_GetTick();
 102:FATFS/Target/user_diskio_spi.c **** 	spiTimerTickDelay = waitTicks;
 103:FATFS/Target/user_diskio_spi.c **** }
 104:FATFS/Target/user_diskio_spi.c **** 
 105:FATFS/Target/user_diskio_spi.c **** uint8_t SPI_Timer_Status()
 106:FATFS/Target/user_diskio_spi.c **** {
 107:FATFS/Target/user_diskio_spi.c **** 	return ((HAL_GetTick() - spiTimerTickStart) < spiTimerTickDelay);
 108:FATFS/Target/user_diskio_spi.c **** }
 109:FATFS/Target/user_diskio_spi.c **** 
 110:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 111:FATFS/Target/user_diskio_spi.c **** /* SPI controls (Platform dependent)                                     */
 112:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 113:FATFS/Target/user_diskio_spi.c **** 
 114:FATFS/Target/user_diskio_spi.c **** /* Exchange a byte */
 115:FATFS/Target/user_diskio_spi.c **** static BYTE xchg_spi(
 116:FATFS/Target/user_diskio_spi.c **** 	BYTE dat /* Data to send */
 117:FATFS/Target/user_diskio_spi.c **** )
 118:FATFS/Target/user_diskio_spi.c **** {
  29              		.loc 1 118 1 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 16
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		.loc 1 118 1 is_stmt 0 view .LVU1
  34 0000 00B5     		push	{lr}
  35              	.LCFI0:
  36              		.cfi_def_cfa_offset 4
  37              		.cfi_offset 14, -4
  38 0002 87B0     		sub	sp, sp, #28
  39              	.LCFI1:
  40              		.cfi_def_cfa_offset 32
  41 0004 8DF80F00 		strb	r0, [sp, #15]
 119:FATFS/Target/user_diskio_spi.c **** 	BYTE rxDat;
  42              		.loc 1 119 2 is_stmt 1 view .LVU2
 120:FATFS/Target/user_diskio_spi.c **** 	HAL_SPI_TransmitReceive(&SD_SPI_HANDLE, &dat, &rxDat, 1, 50);
  43              		.loc 1 120 2 view .LVU3
  44 0008 3223     		movs	r3, #50
  45 000a 0093     		str	r3, [sp]
  46 000c 0123     		movs	r3, #1
  47 000e 0DF11702 		add	r2, sp, #23
  48 0012 0DF10F01 		add	r1, sp, #15
  49 0016 0448     		ldr	r0, .L3
  50              	.LVL1:
  51              		.loc 1 120 2 is_stmt 0 view .LVU4
  52 0018 FFF7FEFF 		bl	HAL_SPI_TransmitReceive
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 4


  53              	.LVL2:
 121:FATFS/Target/user_diskio_spi.c **** 	return rxDat;
  54              		.loc 1 121 2 is_stmt 1 view .LVU5
 122:FATFS/Target/user_diskio_spi.c **** }
  55              		.loc 1 122 1 is_stmt 0 view .LVU6
  56 001c 9DF81700 		ldrb	r0, [sp, #23]	@ zero_extendqisi2
  57 0020 07B0     		add	sp, sp, #28
  58              	.LCFI2:
  59              		.cfi_def_cfa_offset 4
  60              		@ sp needed
  61 0022 5DF804FB 		ldr	pc, [sp], #4
  62              	.L4:
  63 0026 00BF     		.align	2
  64              	.L3:
  65 0028 00000000 		.word	hspi2
  66              		.cfi_endproc
  67              	.LFE134:
  69              		.section	.text.wait_ready,"ax",%progbits
  70              		.align	1
  71              		.syntax unified
  72              		.thumb
  73              		.thumb_func
  74              		.fpu fpv4-sp-d16
  76              	wait_ready:
  77              	.LVL3:
  78              	.LFB137:
 123:FATFS/Target/user_diskio_spi.c **** 
 124:FATFS/Target/user_diskio_spi.c **** /* Receive multiple byte */
 125:FATFS/Target/user_diskio_spi.c **** static void rcvr_spi_multi(
 126:FATFS/Target/user_diskio_spi.c **** 	BYTE *buff, /* Pointer to data buffer */
 127:FATFS/Target/user_diskio_spi.c **** 	UINT btr	/* Number of bytes to receive (even number) */
 128:FATFS/Target/user_diskio_spi.c **** )
 129:FATFS/Target/user_diskio_spi.c **** {
 130:FATFS/Target/user_diskio_spi.c **** 	for (UINT i = 0; i < btr; i++)
 131:FATFS/Target/user_diskio_spi.c **** 	{
 132:FATFS/Target/user_diskio_spi.c **** 		*(buff + i) = xchg_spi(0xFF);
 133:FATFS/Target/user_diskio_spi.c **** 	}
 134:FATFS/Target/user_diskio_spi.c **** }
 135:FATFS/Target/user_diskio_spi.c **** 
 136:FATFS/Target/user_diskio_spi.c **** #if _USE_WRITE
 137:FATFS/Target/user_diskio_spi.c **** /* Send multiple byte */
 138:FATFS/Target/user_diskio_spi.c **** static void xmit_spi_multi(
 139:FATFS/Target/user_diskio_spi.c **** 	const BYTE *buff, /* Pointer to the data */
 140:FATFS/Target/user_diskio_spi.c **** 	UINT btx		  /* Number of bytes to send (even number) */
 141:FATFS/Target/user_diskio_spi.c **** )
 142:FATFS/Target/user_diskio_spi.c **** {
 143:FATFS/Target/user_diskio_spi.c **** 	for (UINT i = 0; i < btx; i++)
 144:FATFS/Target/user_diskio_spi.c **** 	{
 145:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(*(buff + i));
 146:FATFS/Target/user_diskio_spi.c **** 	}
 147:FATFS/Target/user_diskio_spi.c **** }
 148:FATFS/Target/user_diskio_spi.c **** #endif
 149:FATFS/Target/user_diskio_spi.c **** 
 150:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 151:FATFS/Target/user_diskio_spi.c **** /* Wait for card ready                                                   */
 152:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 153:FATFS/Target/user_diskio_spi.c **** 
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 5


 154:FATFS/Target/user_diskio_spi.c **** static int wait_ready(		  /* 1:Ready, 0:Timeout */
 155:FATFS/Target/user_diskio_spi.c **** 					  UINT wt /* Timeout [ms] */
 156:FATFS/Target/user_diskio_spi.c **** )
 157:FATFS/Target/user_diskio_spi.c **** {
  79              		.loc 1 157 1 is_stmt 1 view -0
  80              		.cfi_startproc
  81              		@ args = 0, pretend = 0, frame = 0
  82              		@ frame_needed = 0, uses_anonymous_args = 0
  83              		.loc 1 157 1 is_stmt 0 view .LVU8
  84 0000 70B5     		push	{r4, r5, r6, lr}
  85              	.LCFI3:
  86              		.cfi_def_cfa_offset 16
  87              		.cfi_offset 4, -16
  88              		.cfi_offset 5, -12
  89              		.cfi_offset 6, -8
  90              		.cfi_offset 14, -4
  91 0002 0646     		mov	r6, r0
 158:FATFS/Target/user_diskio_spi.c **** 	BYTE d;
  92              		.loc 1 158 2 is_stmt 1 view .LVU9
 159:FATFS/Target/user_diskio_spi.c **** 	// wait_ready needs its own timer, unfortunately, so it can't use the
 160:FATFS/Target/user_diskio_spi.c **** 	// spi_timer functions
 161:FATFS/Target/user_diskio_spi.c **** 	uint32_t waitSpiTimerTickStart;
  93              		.loc 1 161 2 view .LVU10
 162:FATFS/Target/user_diskio_spi.c **** 	uint32_t waitSpiTimerTickDelay;
  94              		.loc 1 162 2 view .LVU11
 163:FATFS/Target/user_diskio_spi.c **** 
 164:FATFS/Target/user_diskio_spi.c **** 	waitSpiTimerTickStart = HAL_GetTick();
  95              		.loc 1 164 2 view .LVU12
  96              		.loc 1 164 26 is_stmt 0 view .LVU13
  97 0004 FFF7FEFF 		bl	HAL_GetTick
  98              	.LVL4:
  99              		.loc 1 164 26 view .LVU14
 100 0008 0546     		mov	r5, r0
 101              	.LVL5:
 165:FATFS/Target/user_diskio_spi.c **** 	waitSpiTimerTickDelay = (uint32_t)wt;
 102              		.loc 1 165 2 is_stmt 1 view .LVU15
 103              	.L7:
 166:FATFS/Target/user_diskio_spi.c **** 	do
 104              		.loc 1 166 2 discriminator 2 view .LVU16
 167:FATFS/Target/user_diskio_spi.c **** 	{
 168:FATFS/Target/user_diskio_spi.c **** 		d = xchg_spi(0xFF);
 105              		.loc 1 168 3 discriminator 2 view .LVU17
 106              		.loc 1 168 7 is_stmt 0 discriminator 2 view .LVU18
 107 000a FF20     		movs	r0, #255
 108 000c FFF7FEFF 		bl	xchg_spi
 109              	.LVL6:
 110 0010 0446     		mov	r4, r0
 111              	.LVL7:
 169:FATFS/Target/user_diskio_spi.c **** 		/* This loop takes a time. Insert rot_rdq() here for multitask envilonment. */
 170:FATFS/Target/user_diskio_spi.c **** 	} while (d != 0xFF && ((HAL_GetTick() - waitSpiTimerTickStart) < waitSpiTimerTickDelay)); /* Wait 
 112              		.loc 1 170 10 is_stmt 1 discriminator 2 view .LVU19
 113              		.loc 1 170 2 is_stmt 0 discriminator 2 view .LVU20
 114 0012 FF28     		cmp	r0, #255
 115 0014 04D0     		beq	.L6
 116              		.loc 1 170 26 discriminator 1 view .LVU21
 117 0016 FFF7FEFF 		bl	HAL_GetTick
 118              	.LVL8:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 6


 119              		.loc 1 170 40 discriminator 1 view .LVU22
 120 001a 401B     		subs	r0, r0, r5
 121              		.loc 1 170 21 discriminator 1 view .LVU23
 122 001c B042     		cmp	r0, r6
 123 001e F4D3     		bcc	.L7
 124              	.L6:
 171:FATFS/Target/user_diskio_spi.c **** 
 172:FATFS/Target/user_diskio_spi.c **** 	return (d == 0xFF) ? 1 : 0;
 125              		.loc 1 172 2 is_stmt 1 view .LVU24
 173:FATFS/Target/user_diskio_spi.c **** }
 126              		.loc 1 173 1 is_stmt 0 view .LVU25
 127 0020 FF2C     		cmp	r4, #255
 128 0022 14BF     		ite	ne
 129 0024 0020     		movne	r0, #0
 130 0026 0120     		moveq	r0, #1
 131 0028 70BD     		pop	{r4, r5, r6, pc}
 132              		.loc 1 173 1 view .LVU26
 133              		.cfi_endproc
 134              	.LFE137:
 136              		.section	.text.rcvr_spi_multi,"ax",%progbits
 137              		.align	1
 138              		.syntax unified
 139              		.thumb
 140              		.thumb_func
 141              		.fpu fpv4-sp-d16
 143              	rcvr_spi_multi:
 144              	.LVL9:
 145              	.LFB135:
 129:FATFS/Target/user_diskio_spi.c **** 	for (UINT i = 0; i < btr; i++)
 146              		.loc 1 129 1 is_stmt 1 view -0
 147              		.cfi_startproc
 148              		@ args = 0, pretend = 0, frame = 0
 149              		@ frame_needed = 0, uses_anonymous_args = 0
 129:FATFS/Target/user_diskio_spi.c **** 	for (UINT i = 0; i < btr; i++)
 150              		.loc 1 129 1 is_stmt 0 view .LVU28
 151 0000 70B5     		push	{r4, r5, r6, lr}
 152              	.LCFI4:
 153              		.cfi_def_cfa_offset 16
 154              		.cfi_offset 4, -16
 155              		.cfi_offset 5, -12
 156              		.cfi_offset 6, -8
 157              		.cfi_offset 14, -4
 158 0002 0646     		mov	r6, r0
 159 0004 0D46     		mov	r5, r1
 130:FATFS/Target/user_diskio_spi.c **** 	{
 160              		.loc 1 130 2 is_stmt 1 view .LVU29
 161              	.LBB2:
 130:FATFS/Target/user_diskio_spi.c **** 	{
 162              		.loc 1 130 7 view .LVU30
 163              	.LVL10:
 130:FATFS/Target/user_diskio_spi.c **** 	{
 164              		.loc 1 130 12 is_stmt 0 view .LVU31
 165 0006 0024     		movs	r4, #0
 130:FATFS/Target/user_diskio_spi.c **** 	{
 166              		.loc 1 130 2 view .LVU32
 167 0008 04E0     		b	.L10
 168              	.LVL11:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 7


 169              	.L11:
 132:FATFS/Target/user_diskio_spi.c **** 	}
 170              		.loc 1 132 3 is_stmt 1 discriminator 3 view .LVU33
 132:FATFS/Target/user_diskio_spi.c **** 	}
 171              		.loc 1 132 17 is_stmt 0 discriminator 3 view .LVU34
 172 000a FF20     		movs	r0, #255
 173 000c FFF7FEFF 		bl	xchg_spi
 174              	.LVL12:
 132:FATFS/Target/user_diskio_spi.c **** 	}
 175              		.loc 1 132 15 discriminator 3 view .LVU35
 176 0010 3055     		strb	r0, [r6, r4]
 130:FATFS/Target/user_diskio_spi.c **** 	{
 177              		.loc 1 130 28 is_stmt 1 discriminator 3 view .LVU36
 130:FATFS/Target/user_diskio_spi.c **** 	{
 178              		.loc 1 130 29 is_stmt 0 discriminator 3 view .LVU37
 179 0012 0134     		adds	r4, r4, #1
 180              	.LVL13:
 181              	.L10:
 130:FATFS/Target/user_diskio_spi.c **** 	{
 182              		.loc 1 130 19 is_stmt 1 discriminator 1 view .LVU38
 130:FATFS/Target/user_diskio_spi.c **** 	{
 183              		.loc 1 130 2 is_stmt 0 discriminator 1 view .LVU39
 184 0014 AC42     		cmp	r4, r5
 185 0016 F8D3     		bcc	.L11
 186              	.LBE2:
 134:FATFS/Target/user_diskio_spi.c **** 
 187              		.loc 1 134 1 view .LVU40
 188 0018 70BD     		pop	{r4, r5, r6, pc}
 134:FATFS/Target/user_diskio_spi.c **** 
 189              		.loc 1 134 1 view .LVU41
 190              		.cfi_endproc
 191              	.LFE135:
 193              		.section	.text.xmit_spi_multi,"ax",%progbits
 194              		.align	1
 195              		.syntax unified
 196              		.thumb
 197              		.thumb_func
 198              		.fpu fpv4-sp-d16
 200              	xmit_spi_multi:
 201              	.LVL14:
 202              	.LFB136:
 142:FATFS/Target/user_diskio_spi.c **** 	for (UINT i = 0; i < btx; i++)
 203              		.loc 1 142 1 is_stmt 1 view -0
 204              		.cfi_startproc
 205              		@ args = 0, pretend = 0, frame = 0
 206              		@ frame_needed = 0, uses_anonymous_args = 0
 142:FATFS/Target/user_diskio_spi.c **** 	for (UINT i = 0; i < btx; i++)
 207              		.loc 1 142 1 is_stmt 0 view .LVU43
 208 0000 70B5     		push	{r4, r5, r6, lr}
 209              	.LCFI5:
 210              		.cfi_def_cfa_offset 16
 211              		.cfi_offset 4, -16
 212              		.cfi_offset 5, -12
 213              		.cfi_offset 6, -8
 214              		.cfi_offset 14, -4
 215 0002 0646     		mov	r6, r0
 216 0004 0D46     		mov	r5, r1
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 8


 143:FATFS/Target/user_diskio_spi.c **** 	{
 217              		.loc 1 143 2 is_stmt 1 view .LVU44
 218              	.LBB3:
 143:FATFS/Target/user_diskio_spi.c **** 	{
 219              		.loc 1 143 7 view .LVU45
 220              	.LVL15:
 143:FATFS/Target/user_diskio_spi.c **** 	{
 221              		.loc 1 143 12 is_stmt 0 view .LVU46
 222 0006 0024     		movs	r4, #0
 143:FATFS/Target/user_diskio_spi.c **** 	{
 223              		.loc 1 143 2 view .LVU47
 224 0008 03E0     		b	.L14
 225              	.LVL16:
 226              	.L15:
 145:FATFS/Target/user_diskio_spi.c **** 	}
 227              		.loc 1 145 3 is_stmt 1 discriminator 3 view .LVU48
 228 000a 305D     		ldrb	r0, [r6, r4]	@ zero_extendqisi2
 229 000c FFF7FEFF 		bl	xchg_spi
 230              	.LVL17:
 143:FATFS/Target/user_diskio_spi.c **** 	{
 231              		.loc 1 143 28 discriminator 3 view .LVU49
 143:FATFS/Target/user_diskio_spi.c **** 	{
 232              		.loc 1 143 29 is_stmt 0 discriminator 3 view .LVU50
 233 0010 0134     		adds	r4, r4, #1
 234              	.LVL18:
 235              	.L14:
 143:FATFS/Target/user_diskio_spi.c **** 	{
 236              		.loc 1 143 19 is_stmt 1 discriminator 1 view .LVU51
 143:FATFS/Target/user_diskio_spi.c **** 	{
 237              		.loc 1 143 2 is_stmt 0 discriminator 1 view .LVU52
 238 0012 AC42     		cmp	r4, r5
 239 0014 F9D3     		bcc	.L15
 240              	.LBE3:
 147:FATFS/Target/user_diskio_spi.c **** #endif
 241              		.loc 1 147 1 view .LVU53
 242 0016 70BD     		pop	{r4, r5, r6, pc}
 147:FATFS/Target/user_diskio_spi.c **** #endif
 243              		.loc 1 147 1 view .LVU54
 244              		.cfi_endproc
 245              	.LFE136:
 247              		.section	.text.xmit_datablock,"ax",%progbits
 248              		.align	1
 249              		.syntax unified
 250              		.thumb
 251              		.thumb_func
 252              		.fpu fpv4-sp-d16
 254              	xmit_datablock:
 255              	.LVL19:
 256              	.LFB141:
 174:FATFS/Target/user_diskio_spi.c **** 
 175:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 176:FATFS/Target/user_diskio_spi.c **** /* Despiselect card and release SPI                                         */
 177:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 178:FATFS/Target/user_diskio_spi.c **** 
 179:FATFS/Target/user_diskio_spi.c **** static void despiselect(void)
 180:FATFS/Target/user_diskio_spi.c **** {
 181:FATFS/Target/user_diskio_spi.c **** 	CS_HIGH();		/* Set CS# high */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 9


 182:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Dummy clock (force DO hi-z for multiple slave SPI) */
 183:FATFS/Target/user_diskio_spi.c **** }
 184:FATFS/Target/user_diskio_spi.c **** 
 185:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 186:FATFS/Target/user_diskio_spi.c **** /* Select card and wait for ready                                        */
 187:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 188:FATFS/Target/user_diskio_spi.c **** 
 189:FATFS/Target/user_diskio_spi.c **** static int spiselect(void) /* 1:OK, 0:Timeout */
 190:FATFS/Target/user_diskio_spi.c **** {
 191:FATFS/Target/user_diskio_spi.c **** 	CS_LOW();		/* Set CS# low */
 192:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Dummy clock (force DO enabled) */
 193:FATFS/Target/user_diskio_spi.c **** 	if (wait_ready(500))
 194:FATFS/Target/user_diskio_spi.c **** 		return 1; /* Wait for card ready */
 195:FATFS/Target/user_diskio_spi.c **** 
 196:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 197:FATFS/Target/user_diskio_spi.c **** 	return 0; /* Timeout */
 198:FATFS/Target/user_diskio_spi.c **** }
 199:FATFS/Target/user_diskio_spi.c **** 
 200:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 201:FATFS/Target/user_diskio_spi.c **** /* Receive a data packet from the MMC                                    */
 202:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 203:FATFS/Target/user_diskio_spi.c **** 
 204:FATFS/Target/user_diskio_spi.c **** BYTE token;
 205:FATFS/Target/user_diskio_spi.c **** 
 206:FATFS/Target/user_diskio_spi.c **** static int rcvr_datablock(			  /* 1:OK, 0:Error */
 207:FATFS/Target/user_diskio_spi.c **** 						  BYTE *buff, /* Data buffer */
 208:FATFS/Target/user_diskio_spi.c **** 						  UINT btr	  /* Data block length (byte) */
 209:FATFS/Target/user_diskio_spi.c **** )
 210:FATFS/Target/user_diskio_spi.c **** {
 211:FATFS/Target/user_diskio_spi.c **** 	token = 0;
 212:FATFS/Target/user_diskio_spi.c **** 
 213:FATFS/Target/user_diskio_spi.c **** 	SPI_Timer_On(1000);
 214:FATFS/Target/user_diskio_spi.c **** 	do
 215:FATFS/Target/user_diskio_spi.c **** 	{ /* Wait for DataStart token in timeout of 200ms */
 216:FATFS/Target/user_diskio_spi.c **** 		token = xchg_spi(0xFF);
 217:FATFS/Target/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 218:FATFS/Target/user_diskio_spi.c **** 	} while ((token == 0xFF) && SPI_Timer_Status());
 219:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFE)
 220:FATFS/Target/user_diskio_spi.c **** 		return 0; /* Function fails if invalid DataStart token or timeout */
 221:FATFS/Target/user_diskio_spi.c **** 
 222:FATFS/Target/user_diskio_spi.c **** 	rcvr_spi_multi(buff, btr); /* Store trailing data to the buffer */
 223:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF);
 224:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Discard CRC */
 225:FATFS/Target/user_diskio_spi.c **** 
 226:FATFS/Target/user_diskio_spi.c **** 	return 1; /* Function succeeded */
 227:FATFS/Target/user_diskio_spi.c **** }
 228:FATFS/Target/user_diskio_spi.c **** 
 229:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 230:FATFS/Target/user_diskio_spi.c **** /* Send a data packet to the MMC                                         */
 231:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 232:FATFS/Target/user_diskio_spi.c **** 
 233:FATFS/Target/user_diskio_spi.c **** #if _USE_WRITE
 234:FATFS/Target/user_diskio_spi.c **** static int xmit_datablock(					/* 1:OK, 0:Failed */
 235:FATFS/Target/user_diskio_spi.c **** 						  const BYTE *buff, /* Ponter to 512 byte data to be sent */
 236:FATFS/Target/user_diskio_spi.c **** 						  BYTE token		/* Token */
 237:FATFS/Target/user_diskio_spi.c **** )
 238:FATFS/Target/user_diskio_spi.c **** {
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 10


 257              		.loc 1 238 1 is_stmt 1 view -0
 258              		.cfi_startproc
 259              		@ args = 0, pretend = 0, frame = 0
 260              		@ frame_needed = 0, uses_anonymous_args = 0
 261              		.loc 1 238 1 is_stmt 0 view .LVU56
 262 0000 38B5     		push	{r3, r4, r5, lr}
 263              	.LCFI6:
 264              		.cfi_def_cfa_offset 16
 265              		.cfi_offset 3, -16
 266              		.cfi_offset 4, -12
 267              		.cfi_offset 5, -8
 268              		.cfi_offset 14, -4
 269 0002 0546     		mov	r5, r0
 270 0004 0C46     		mov	r4, r1
 239:FATFS/Target/user_diskio_spi.c **** 	BYTE resp;
 271              		.loc 1 239 2 is_stmt 1 view .LVU57
 240:FATFS/Target/user_diskio_spi.c **** 
 241:FATFS/Target/user_diskio_spi.c **** 	if (!wait_ready(500))
 272              		.loc 1 241 2 view .LVU58
 273              		.loc 1 241 7 is_stmt 0 view .LVU59
 274 0006 4FF4FA70 		mov	r0, #500
 275              	.LVL20:
 276              		.loc 1 241 7 view .LVU60
 277 000a FFF7FEFF 		bl	wait_ready
 278              	.LVL21:
 279              		.loc 1 241 5 view .LVU61
 280 000e 00B9     		cbnz	r0, .L22
 281              	.L17:
 242:FATFS/Target/user_diskio_spi.c **** 		return 0; /* Wait for card ready */
 243:FATFS/Target/user_diskio_spi.c **** 
 244:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(token); /* Send token */
 245:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFD)
 246:FATFS/Target/user_diskio_spi.c **** 	{							   /* Send data if token is other than StopTran */
 247:FATFS/Target/user_diskio_spi.c **** 		xmit_spi_multi(buff, 512); /* Data */
 248:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(0xFF);
 249:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(0xFF); /* Dummy CRC */
 250:FATFS/Target/user_diskio_spi.c **** 
 251:FATFS/Target/user_diskio_spi.c **** 		resp = xchg_spi(0xFF); /* Receive data resp */
 252:FATFS/Target/user_diskio_spi.c **** 		if ((resp & 0x1F) != 0x05)
 253:FATFS/Target/user_diskio_spi.c **** 			return 0; /* Function fails if the data packet was not accepted */
 254:FATFS/Target/user_diskio_spi.c **** 	}
 255:FATFS/Target/user_diskio_spi.c **** 	return 1;
 256:FATFS/Target/user_diskio_spi.c **** }
 282              		.loc 1 256 1 view .LVU62
 283 0010 38BD     		pop	{r3, r4, r5, pc}
 284              	.LVL22:
 285              	.L22:
 244:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFD)
 286              		.loc 1 244 2 is_stmt 1 view .LVU63
 287 0012 2046     		mov	r0, r4
 288 0014 FFF7FEFF 		bl	xchg_spi
 289              	.LVL23:
 245:FATFS/Target/user_diskio_spi.c **** 	{							   /* Send data if token is other than StopTran */
 290              		.loc 1 245 2 view .LVU64
 245:FATFS/Target/user_diskio_spi.c **** 	{							   /* Send data if token is other than StopTran */
 291              		.loc 1 245 5 is_stmt 0 view .LVU65
 292 0018 FD2C     		cmp	r4, #253
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 11


 293 001a 01D1     		bne	.L23
 255:FATFS/Target/user_diskio_spi.c **** }
 294              		.loc 1 255 9 view .LVU66
 295 001c 0120     		movs	r0, #1
 296 001e F7E7     		b	.L17
 297              	.L23:
 247:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(0xFF);
 298              		.loc 1 247 3 is_stmt 1 view .LVU67
 299 0020 4FF40071 		mov	r1, #512
 300 0024 2846     		mov	r0, r5
 301 0026 FFF7FEFF 		bl	xmit_spi_multi
 302              	.LVL24:
 248:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(0xFF); /* Dummy CRC */
 303              		.loc 1 248 3 view .LVU68
 304 002a FF20     		movs	r0, #255
 305 002c FFF7FEFF 		bl	xchg_spi
 306              	.LVL25:
 249:FATFS/Target/user_diskio_spi.c **** 
 307              		.loc 1 249 3 view .LVU69
 308 0030 FF20     		movs	r0, #255
 309 0032 FFF7FEFF 		bl	xchg_spi
 310              	.LVL26:
 251:FATFS/Target/user_diskio_spi.c **** 		if ((resp & 0x1F) != 0x05)
 311              		.loc 1 251 3 view .LVU70
 251:FATFS/Target/user_diskio_spi.c **** 		if ((resp & 0x1F) != 0x05)
 312              		.loc 1 251 10 is_stmt 0 view .LVU71
 313 0036 FF20     		movs	r0, #255
 314 0038 FFF7FEFF 		bl	xchg_spi
 315              	.LVL27:
 252:FATFS/Target/user_diskio_spi.c **** 			return 0; /* Function fails if the data packet was not accepted */
 316              		.loc 1 252 3 is_stmt 1 view .LVU72
 252:FATFS/Target/user_diskio_spi.c **** 			return 0; /* Function fails if the data packet was not accepted */
 317              		.loc 1 252 6 is_stmt 0 view .LVU73
 318 003c 00F01F00 		and	r0, r0, #31
 319              	.LVL28:
 252:FATFS/Target/user_diskio_spi.c **** 			return 0; /* Function fails if the data packet was not accepted */
 320              		.loc 1 252 6 view .LVU74
 321 0040 0528     		cmp	r0, #5
 322 0042 01D1     		bne	.L20
 255:FATFS/Target/user_diskio_spi.c **** }
 323              		.loc 1 255 9 view .LVU75
 324 0044 0120     		movs	r0, #1
 325 0046 E3E7     		b	.L17
 326              	.L20:
 253:FATFS/Target/user_diskio_spi.c **** 	}
 327              		.loc 1 253 11 view .LVU76
 328 0048 0020     		movs	r0, #0
 329 004a E1E7     		b	.L17
 330              		.cfi_endproc
 331              	.LFE141:
 333              		.section	.text.despiselect,"ax",%progbits
 334              		.align	1
 335              		.syntax unified
 336              		.thumb
 337              		.thumb_func
 338              		.fpu fpv4-sp-d16
 340              	despiselect:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 12


 341              	.LFB138:
 180:FATFS/Target/user_diskio_spi.c **** 	CS_HIGH();		/* Set CS# high */
 342              		.loc 1 180 1 is_stmt 1 view -0
 343              		.cfi_startproc
 344              		@ args = 0, pretend = 0, frame = 0
 345              		@ frame_needed = 0, uses_anonymous_args = 0
 346 0000 08B5     		push	{r3, lr}
 347              	.LCFI7:
 348              		.cfi_def_cfa_offset 8
 349              		.cfi_offset 3, -8
 350              		.cfi_offset 14, -4
 181:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Dummy clock (force DO hi-z for multiple slave SPI) */
 351              		.loc 1 181 2 view .LVU78
 352 0002 0122     		movs	r2, #1
 353 0004 4FF48051 		mov	r1, #4096
 354 0008 0348     		ldr	r0, .L26
 355 000a FFF7FEFF 		bl	HAL_GPIO_WritePin
 356              	.LVL29:
 181:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Dummy clock (force DO hi-z for multiple slave SPI) */
 357              		.loc 1 181 11 view .LVU79
 182:FATFS/Target/user_diskio_spi.c **** }
 358              		.loc 1 182 2 view .LVU80
 359 000e FF20     		movs	r0, #255
 360 0010 FFF7FEFF 		bl	xchg_spi
 361              	.LVL30:
 183:FATFS/Target/user_diskio_spi.c **** 
 362              		.loc 1 183 1 is_stmt 0 view .LVU81
 363 0014 08BD     		pop	{r3, pc}
 364              	.L27:
 365 0016 00BF     		.align	2
 366              	.L26:
 367 0018 00040048 		.word	1207960576
 368              		.cfi_endproc
 369              	.LFE138:
 371              		.section	.text.spiselect,"ax",%progbits
 372              		.align	1
 373              		.syntax unified
 374              		.thumb
 375              		.thumb_func
 376              		.fpu fpv4-sp-d16
 378              	spiselect:
 379              	.LFB139:
 190:FATFS/Target/user_diskio_spi.c **** 	CS_LOW();		/* Set CS# low */
 380              		.loc 1 190 1 is_stmt 1 view -0
 381              		.cfi_startproc
 382              		@ args = 0, pretend = 0, frame = 0
 383              		@ frame_needed = 0, uses_anonymous_args = 0
 384 0000 10B5     		push	{r4, lr}
 385              	.LCFI8:
 386              		.cfi_def_cfa_offset 8
 387              		.cfi_offset 4, -8
 388              		.cfi_offset 14, -4
 191:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Dummy clock (force DO enabled) */
 389              		.loc 1 191 2 view .LVU83
 390 0002 0022     		movs	r2, #0
 391 0004 4FF48051 		mov	r1, #4096
 392 0008 0848     		ldr	r0, .L33
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 13


 393 000a FFF7FEFF 		bl	HAL_GPIO_WritePin
 394              	.LVL31:
 191:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Dummy clock (force DO enabled) */
 395              		.loc 1 191 10 view .LVU84
 192:FATFS/Target/user_diskio_spi.c **** 	if (wait_ready(500))
 396              		.loc 1 192 2 view .LVU85
 397 000e FF20     		movs	r0, #255
 398 0010 FFF7FEFF 		bl	xchg_spi
 399              	.LVL32:
 193:FATFS/Target/user_diskio_spi.c **** 		return 1; /* Wait for card ready */
 400              		.loc 1 193 2 view .LVU86
 193:FATFS/Target/user_diskio_spi.c **** 		return 1; /* Wait for card ready */
 401              		.loc 1 193 6 is_stmt 0 view .LVU87
 402 0014 4FF4FA70 		mov	r0, #500
 403 0018 FFF7FEFF 		bl	wait_ready
 404              	.LVL33:
 193:FATFS/Target/user_diskio_spi.c **** 		return 1; /* Wait for card ready */
 405              		.loc 1 193 5 view .LVU88
 406 001c 10B1     		cbz	r0, .L32
 194:FATFS/Target/user_diskio_spi.c **** 
 407              		.loc 1 194 10 view .LVU89
 408 001e 0124     		movs	r4, #1
 409              	.L28:
 198:FATFS/Target/user_diskio_spi.c **** 
 410              		.loc 1 198 1 view .LVU90
 411 0020 2046     		mov	r0, r4
 412 0022 10BD     		pop	{r4, pc}
 413              	.L32:
 414 0024 0446     		mov	r4, r0
 196:FATFS/Target/user_diskio_spi.c **** 	return 0; /* Timeout */
 415              		.loc 1 196 2 is_stmt 1 view .LVU91
 416 0026 FFF7FEFF 		bl	despiselect
 417              	.LVL34:
 197:FATFS/Target/user_diskio_spi.c **** }
 418              		.loc 1 197 2 view .LVU92
 197:FATFS/Target/user_diskio_spi.c **** }
 419              		.loc 1 197 9 is_stmt 0 view .LVU93
 420 002a F9E7     		b	.L28
 421              	.L34:
 422              		.align	2
 423              	.L33:
 424 002c 00040048 		.word	1207960576
 425              		.cfi_endproc
 426              	.LFE139:
 428              		.section	.text.send_cmd,"ax",%progbits
 429              		.align	1
 430              		.syntax unified
 431              		.thumb
 432              		.thumb_func
 433              		.fpu fpv4-sp-d16
 435              	send_cmd:
 436              	.LVL35:
 437              	.LFB142:
 257:FATFS/Target/user_diskio_spi.c **** #endif
 258:FATFS/Target/user_diskio_spi.c **** 
 259:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 260:FATFS/Target/user_diskio_spi.c **** /* Send a command packet to the MMC                                      */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 14


 261:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 262:FATFS/Target/user_diskio_spi.c **** int cmdBuffer[100];
 263:FATFS/Target/user_diskio_spi.c **** int pivot = 0;
 264:FATFS/Target/user_diskio_spi.c **** 
 265:FATFS/Target/user_diskio_spi.c **** static BYTE send_cmd(		   /* Return value: R1 resp (bit7==1:Failed to send) */
 266:FATFS/Target/user_diskio_spi.c **** 					 BYTE cmd, /* Command index */
 267:FATFS/Target/user_diskio_spi.c **** 					 DWORD arg /* Argument */
 268:FATFS/Target/user_diskio_spi.c **** )
 269:FATFS/Target/user_diskio_spi.c **** {
 438              		.loc 1 269 1 is_stmt 1 view -0
 439              		.cfi_startproc
 440              		@ args = 0, pretend = 0, frame = 0
 441              		@ frame_needed = 0, uses_anonymous_args = 0
 442              		.loc 1 269 1 is_stmt 0 view .LVU95
 443 0000 38B5     		push	{r3, r4, r5, lr}
 444              	.LCFI9:
 445              		.cfi_def_cfa_offset 16
 446              		.cfi_offset 3, -16
 447              		.cfi_offset 4, -12
 448              		.cfi_offset 5, -8
 449              		.cfi_offset 14, -4
 450 0002 0446     		mov	r4, r0
 451 0004 0D46     		mov	r5, r1
 270:FATFS/Target/user_diskio_spi.c **** 	BYTE n, res;
 452              		.loc 1 270 2 is_stmt 1 view .LVU96
 271:FATFS/Target/user_diskio_spi.c **** 
 272:FATFS/Target/user_diskio_spi.c **** 	if (cmd & 0x80)
 453              		.loc 1 272 2 view .LVU97
 454              		.loc 1 272 5 is_stmt 0 view .LVU98
 455 0006 10F0800F 		tst	r0, #128
 456 000a 33D1     		bne	.L47
 457              	.LVL36:
 458              	.L36:
 273:FATFS/Target/user_diskio_spi.c **** 	{ /* Send a CMD55 prior to ACMD<n> */
 274:FATFS/Target/user_diskio_spi.c **** 		cmd &= 0x7F;
 275:FATFS/Target/user_diskio_spi.c **** 		res = send_cmd(CMD55, 0);
 276:FATFS/Target/user_diskio_spi.c **** 		if (res > 1)
 277:FATFS/Target/user_diskio_spi.c **** 			return res;
 278:FATFS/Target/user_diskio_spi.c **** 	}
 279:FATFS/Target/user_diskio_spi.c **** 
 280:FATFS/Target/user_diskio_spi.c **** 	cmdBuffer[pivot] = cmd;
 459              		.loc 1 280 2 is_stmt 1 view .LVU99
 460              		.loc 1 280 11 is_stmt 0 view .LVU100
 461 000c 234A     		ldr	r2, .L50
 462 000e 1368     		ldr	r3, [r2]
 463              		.loc 1 280 19 view .LVU101
 464 0010 2349     		ldr	r1, .L50+4
 465 0012 41F82340 		str	r4, [r1, r3, lsl #2]
 281:FATFS/Target/user_diskio_spi.c **** 	pivot++;
 466              		.loc 1 281 2 is_stmt 1 view .LVU102
 467              		.loc 1 281 7 is_stmt 0 view .LVU103
 468 0016 0133     		adds	r3, r3, #1
 469 0018 1360     		str	r3, [r2]
 282:FATFS/Target/user_diskio_spi.c **** 
 283:FATFS/Target/user_diskio_spi.c **** 	/* Select the card and wait for ready except to stop multiple block read */
 284:FATFS/Target/user_diskio_spi.c **** 	if (cmd != CMD12)
 470              		.loc 1 284 2 is_stmt 1 view .LVU104
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 15


 471              		.loc 1 284 5 is_stmt 0 view .LVU105
 472 001a 0C2C     		cmp	r4, #12
 473 001c 04D0     		beq	.L38
 285:FATFS/Target/user_diskio_spi.c **** 	{
 286:FATFS/Target/user_diskio_spi.c **** 		despiselect();
 474              		.loc 1 286 3 is_stmt 1 view .LVU106
 475 001e FFF7FEFF 		bl	despiselect
 476              	.LVL37:
 287:FATFS/Target/user_diskio_spi.c **** 		if (!spiselect())
 477              		.loc 1 287 3 view .LVU107
 478              		.loc 1 287 8 is_stmt 0 view .LVU108
 479 0022 FFF7FEFF 		bl	spiselect
 480              	.LVL38:
 481              		.loc 1 287 6 view .LVU109
 482 0026 B0B3     		cbz	r0, .L43
 483              	.L38:
 288:FATFS/Target/user_diskio_spi.c **** 			return 0xFF;
 289:FATFS/Target/user_diskio_spi.c **** 	}
 290:FATFS/Target/user_diskio_spi.c **** 
 291:FATFS/Target/user_diskio_spi.c **** 	/* Send command packet */
 292:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0x40 | cmd);		 /* Start + command index */
 484              		.loc 1 292 2 is_stmt 1 view .LVU110
 485 0028 44F04000 		orr	r0, r4, #64
 486 002c FFF7FEFF 		bl	xchg_spi
 487              	.LVL39:
 293:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 24)); /* Argument[31..24] */
 488              		.loc 1 293 2 view .LVU111
 489 0030 280E     		lsrs	r0, r5, #24
 490 0032 FFF7FEFF 		bl	xchg_spi
 491              	.LVL40:
 294:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 16)); /* Argument[23..16] */
 492              		.loc 1 294 2 view .LVU112
 493 0036 C5F30740 		ubfx	r0, r5, #16, #8
 494 003a FFF7FEFF 		bl	xchg_spi
 495              	.LVL41:
 295:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 8));	 /* Argument[15..8] */
 496              		.loc 1 295 2 view .LVU113
 497 003e C5F30720 		ubfx	r0, r5, #8, #8
 498 0042 FFF7FEFF 		bl	xchg_spi
 499              	.LVL42:
 296:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)arg);		 /* Argument[7..0] */
 500              		.loc 1 296 2 view .LVU114
 501 0046 E8B2     		uxtb	r0, r5
 502 0048 FFF7FEFF 		bl	xchg_spi
 503              	.LVL43:
 297:FATFS/Target/user_diskio_spi.c **** 	n = 0x01;					 /* Dummy CRC + Stop */
 504              		.loc 1 297 2 view .LVU115
 298:FATFS/Target/user_diskio_spi.c **** 	if (cmd == CMD0)
 505              		.loc 1 298 2 view .LVU116
 506              		.loc 1 298 5 is_stmt 0 view .LVU117
 507 004c DCB1     		cbz	r4, .L44
 297:FATFS/Target/user_diskio_spi.c **** 	n = 0x01;					 /* Dummy CRC + Stop */
 508              		.loc 1 297 4 view .LVU118
 509 004e 0120     		movs	r0, #1
 510              	.L39:
 511              	.LVL44:
 299:FATFS/Target/user_diskio_spi.c **** 		n = 0x95; /* Valid CRC for CMD0(0) */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 16


 300:FATFS/Target/user_diskio_spi.c **** 	if (cmd == CMD8)
 512              		.loc 1 300 2 is_stmt 1 view .LVU119
 513              		.loc 1 300 5 is_stmt 0 view .LVU120
 514 0050 082C     		cmp	r4, #8
 515 0052 1AD0     		beq	.L48
 516              	.LVL45:
 517              	.L40:
 301:FATFS/Target/user_diskio_spi.c **** 		n = 0x87; /* Valid CRC for CMD8(0x1AA) */
 302:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(n);
 518              		.loc 1 302 2 is_stmt 1 view .LVU121
 519 0054 FFF7FEFF 		bl	xchg_spi
 520              	.LVL46:
 303:FATFS/Target/user_diskio_spi.c **** 
 304:FATFS/Target/user_diskio_spi.c **** 	/* Receive command resp */
 305:FATFS/Target/user_diskio_spi.c **** 	if (cmd == CMD12)
 521              		.loc 1 305 2 view .LVU122
 522              		.loc 1 305 5 is_stmt 0 view .LVU123
 523 0058 0C2C     		cmp	r4, #12
 524 005a 18D0     		beq	.L49
 525              	.L41:
 301:FATFS/Target/user_diskio_spi.c **** 		n = 0x87; /* Valid CRC for CMD8(0x1AA) */
 526              		.loc 1 301 5 discriminator 2 view .LVU124
 527 005c 0A24     		movs	r4, #10
 528              	.LVL47:
 529              	.L42:
 306:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(0xFF); /* Diacard following one byte when CMD12 */
 307:FATFS/Target/user_diskio_spi.c **** 	n = 10;				/* Wait for response (10 bytes max) */
 308:FATFS/Target/user_diskio_spi.c **** 	do
 530              		.loc 1 308 2 is_stmt 1 discriminator 2 view .LVU125
 309:FATFS/Target/user_diskio_spi.c **** 	{
 310:FATFS/Target/user_diskio_spi.c **** 		res = xchg_spi(0xFF);
 531              		.loc 1 310 3 discriminator 2 view .LVU126
 532              		.loc 1 310 9 is_stmt 0 discriminator 2 view .LVU127
 533 005e FF20     		movs	r0, #255
 534 0060 FFF7FEFF 		bl	xchg_spi
 535              	.LVL48:
 311:FATFS/Target/user_diskio_spi.c **** 	} while ((res & 0x80) && --n);
 536              		.loc 1 311 10 is_stmt 1 discriminator 2 view .LVU128
 537              		.loc 1 311 2 is_stmt 0 discriminator 2 view .LVU129
 538 0064 10F0800F 		tst	r0, #128
 539 0068 03D0     		beq	.L37
 540              		.loc 1 311 24 discriminator 1 view .LVU130
 541 006a 631E     		subs	r3, r4, #1
 542              	.LVL49:
 543              		.loc 1 311 24 discriminator 1 view .LVU131
 544 006c 13F0FF04 		ands	r4, r3, #255
 545 0070 F5D1     		bne	.L42
 546              	.LVL50:
 547              	.L37:
 312:FATFS/Target/user_diskio_spi.c **** 	// xchg_spi(0xFF); /* Send an extra dummy byte to make SD well-prepared*/
 313:FATFS/Target/user_diskio_spi.c **** 
 314:FATFS/Target/user_diskio_spi.c **** 	return res; /* Return received response */
 315:FATFS/Target/user_diskio_spi.c **** }
 548              		.loc 1 315 1 view .LVU132
 549 0072 38BD     		pop	{r3, r4, r5, pc}
 550              	.LVL51:
 551              	.L47:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 17


 274:FATFS/Target/user_diskio_spi.c **** 		res = send_cmd(CMD55, 0);
 552              		.loc 1 274 3 is_stmt 1 view .LVU133
 274:FATFS/Target/user_diskio_spi.c **** 		res = send_cmd(CMD55, 0);
 553              		.loc 1 274 7 is_stmt 0 view .LVU134
 554 0074 00F07F04 		and	r4, r0, #127
 555              	.LVL52:
 275:FATFS/Target/user_diskio_spi.c **** 		if (res > 1)
 556              		.loc 1 275 3 is_stmt 1 view .LVU135
 275:FATFS/Target/user_diskio_spi.c **** 		if (res > 1)
 557              		.loc 1 275 9 is_stmt 0 view .LVU136
 558 0078 0021     		movs	r1, #0
 559              	.LVL53:
 275:FATFS/Target/user_diskio_spi.c **** 		if (res > 1)
 560              		.loc 1 275 9 view .LVU137
 561 007a 3720     		movs	r0, #55
 562 007c FFF7C0FF 		bl	send_cmd
 563              	.LVL54:
 276:FATFS/Target/user_diskio_spi.c **** 			return res;
 564              		.loc 1 276 3 is_stmt 1 view .LVU138
 276:FATFS/Target/user_diskio_spi.c **** 			return res;
 565              		.loc 1 276 6 is_stmt 0 view .LVU139
 566 0080 0128     		cmp	r0, #1
 567 0082 C3D9     		bls	.L36
 568 0084 F5E7     		b	.L37
 569              	.LVL55:
 570              	.L44:
 299:FATFS/Target/user_diskio_spi.c **** 	if (cmd == CMD8)
 571              		.loc 1 299 5 view .LVU140
 572 0086 9520     		movs	r0, #149
 573 0088 E2E7     		b	.L39
 574              	.LVL56:
 575              	.L48:
 301:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(n);
 576              		.loc 1 301 5 view .LVU141
 577 008a 8720     		movs	r0, #135
 578              	.LVL57:
 301:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(n);
 579              		.loc 1 301 5 view .LVU142
 580 008c E2E7     		b	.L40
 581              	.L49:
 306:FATFS/Target/user_diskio_spi.c **** 	n = 10;				/* Wait for response (10 bytes max) */
 582              		.loc 1 306 3 is_stmt 1 view .LVU143
 583 008e FF20     		movs	r0, #255
 584 0090 FFF7FEFF 		bl	xchg_spi
 585              	.LVL58:
 586 0094 E2E7     		b	.L41
 587              	.L43:
 288:FATFS/Target/user_diskio_spi.c **** 	}
 588              		.loc 1 288 11 is_stmt 0 view .LVU144
 589 0096 FF20     		movs	r0, #255
 590 0098 EBE7     		b	.L37
 591              	.L51:
 592 009a 00BF     		.align	2
 593              	.L50:
 594 009c 00000000 		.word	.LANCHOR0
 595 00a0 00000000 		.word	.LANCHOR1
 596              		.cfi_endproc
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 18


 597              	.LFE142:
 599              		.section	.text.SPI_Timer_On,"ax",%progbits
 600              		.align	1
 601              		.global	SPI_Timer_On
 602              		.syntax unified
 603              		.thumb
 604              		.thumb_func
 605              		.fpu fpv4-sp-d16
 607              	SPI_Timer_On:
 608              	.LVL59:
 609              	.LFB132:
 100:FATFS/Target/user_diskio_spi.c **** 	spiTimerTickStart = HAL_GetTick();
 610              		.loc 1 100 1 is_stmt 1 view -0
 611              		.cfi_startproc
 612              		@ args = 0, pretend = 0, frame = 0
 613              		@ frame_needed = 0, uses_anonymous_args = 0
 100:FATFS/Target/user_diskio_spi.c **** 	spiTimerTickStart = HAL_GetTick();
 614              		.loc 1 100 1 is_stmt 0 view .LVU146
 615 0000 10B5     		push	{r4, lr}
 616              	.LCFI10:
 617              		.cfi_def_cfa_offset 8
 618              		.cfi_offset 4, -8
 619              		.cfi_offset 14, -4
 620 0002 0446     		mov	r4, r0
 101:FATFS/Target/user_diskio_spi.c **** 	spiTimerTickDelay = waitTicks;
 621              		.loc 1 101 2 is_stmt 1 view .LVU147
 101:FATFS/Target/user_diskio_spi.c **** 	spiTimerTickDelay = waitTicks;
 622              		.loc 1 101 22 is_stmt 0 view .LVU148
 623 0004 FFF7FEFF 		bl	HAL_GetTick
 624              	.LVL60:
 101:FATFS/Target/user_diskio_spi.c **** 	spiTimerTickDelay = waitTicks;
 625              		.loc 1 101 20 view .LVU149
 626 0008 024B     		ldr	r3, .L54
 627 000a 1860     		str	r0, [r3]
 102:FATFS/Target/user_diskio_spi.c **** }
 628              		.loc 1 102 2 is_stmt 1 view .LVU150
 102:FATFS/Target/user_diskio_spi.c **** }
 629              		.loc 1 102 20 is_stmt 0 view .LVU151
 630 000c 024B     		ldr	r3, .L54+4
 631 000e 1C60     		str	r4, [r3]
 103:FATFS/Target/user_diskio_spi.c **** 
 632              		.loc 1 103 1 view .LVU152
 633 0010 10BD     		pop	{r4, pc}
 634              	.LVL61:
 635              	.L55:
 103:FATFS/Target/user_diskio_spi.c **** 
 636              		.loc 1 103 1 view .LVU153
 637 0012 00BF     		.align	2
 638              	.L54:
 639 0014 00000000 		.word	.LANCHOR2
 640 0018 00000000 		.word	.LANCHOR3
 641              		.cfi_endproc
 642              	.LFE132:
 644              		.section	.text.SPI_Timer_Status,"ax",%progbits
 645              		.align	1
 646              		.global	SPI_Timer_Status
 647              		.syntax unified
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 19


 648              		.thumb
 649              		.thumb_func
 650              		.fpu fpv4-sp-d16
 652              	SPI_Timer_Status:
 653              	.LFB133:
 106:FATFS/Target/user_diskio_spi.c **** 	return ((HAL_GetTick() - spiTimerTickStart) < spiTimerTickDelay);
 654              		.loc 1 106 1 is_stmt 1 view -0
 655              		.cfi_startproc
 656              		@ args = 0, pretend = 0, frame = 0
 657              		@ frame_needed = 0, uses_anonymous_args = 0
 658 0000 08B5     		push	{r3, lr}
 659              	.LCFI11:
 660              		.cfi_def_cfa_offset 8
 661              		.cfi_offset 3, -8
 662              		.cfi_offset 14, -4
 107:FATFS/Target/user_diskio_spi.c **** }
 663              		.loc 1 107 2 view .LVU155
 107:FATFS/Target/user_diskio_spi.c **** }
 664              		.loc 1 107 11 is_stmt 0 view .LVU156
 665 0002 FFF7FEFF 		bl	HAL_GetTick
 666              	.LVL62:
 107:FATFS/Target/user_diskio_spi.c **** }
 667              		.loc 1 107 25 view .LVU157
 668 0006 054B     		ldr	r3, .L58
 669 0008 1B68     		ldr	r3, [r3]
 670 000a C01A     		subs	r0, r0, r3
 107:FATFS/Target/user_diskio_spi.c **** }
 671              		.loc 1 107 46 view .LVU158
 672 000c 044B     		ldr	r3, .L58+4
 673 000e 1B68     		ldr	r3, [r3]
 108:FATFS/Target/user_diskio_spi.c **** 
 674              		.loc 1 108 1 view .LVU159
 675 0010 9842     		cmp	r0, r3
 676 0012 2CBF     		ite	cs
 677 0014 0020     		movcs	r0, #0
 678 0016 0120     		movcc	r0, #1
 679 0018 08BD     		pop	{r3, pc}
 680              	.L59:
 681 001a 00BF     		.align	2
 682              	.L58:
 683 001c 00000000 		.word	.LANCHOR2
 684 0020 00000000 		.word	.LANCHOR3
 685              		.cfi_endproc
 686              	.LFE133:
 688              		.section	.text.rcvr_datablock,"ax",%progbits
 689              		.align	1
 690              		.syntax unified
 691              		.thumb
 692              		.thumb_func
 693              		.fpu fpv4-sp-d16
 695              	rcvr_datablock:
 696              	.LVL63:
 697              	.LFB140:
 210:FATFS/Target/user_diskio_spi.c **** 	token = 0;
 698              		.loc 1 210 1 is_stmt 1 view -0
 699              		.cfi_startproc
 700              		@ args = 0, pretend = 0, frame = 0
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 20


 701              		@ frame_needed = 0, uses_anonymous_args = 0
 210:FATFS/Target/user_diskio_spi.c **** 	token = 0;
 702              		.loc 1 210 1 is_stmt 0 view .LVU161
 703 0000 38B5     		push	{r3, r4, r5, lr}
 704              	.LCFI12:
 705              		.cfi_def_cfa_offset 16
 706              		.cfi_offset 3, -16
 707              		.cfi_offset 4, -12
 708              		.cfi_offset 5, -8
 709              		.cfi_offset 14, -4
 710 0002 0446     		mov	r4, r0
 711 0004 0D46     		mov	r5, r1
 211:FATFS/Target/user_diskio_spi.c **** 
 712              		.loc 1 211 2 is_stmt 1 view .LVU162
 211:FATFS/Target/user_diskio_spi.c **** 
 713              		.loc 1 211 8 is_stmt 0 view .LVU163
 714 0006 124B     		ldr	r3, .L67
 715 0008 0022     		movs	r2, #0
 716 000a 1A70     		strb	r2, [r3]
 213:FATFS/Target/user_diskio_spi.c **** 	do
 717              		.loc 1 213 2 is_stmt 1 view .LVU164
 718 000c 4FF47A70 		mov	r0, #1000
 719              	.LVL64:
 213:FATFS/Target/user_diskio_spi.c **** 	do
 720              		.loc 1 213 2 is_stmt 0 view .LVU165
 721 0010 FFF7FEFF 		bl	SPI_Timer_On
 722              	.LVL65:
 723              	.L62:
 214:FATFS/Target/user_diskio_spi.c **** 	{ /* Wait for DataStart token in timeout of 200ms */
 724              		.loc 1 214 2 is_stmt 1 discriminator 2 view .LVU166
 216:FATFS/Target/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 725              		.loc 1 216 3 discriminator 2 view .LVU167
 216:FATFS/Target/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 726              		.loc 1 216 11 is_stmt 0 discriminator 2 view .LVU168
 727 0014 FF20     		movs	r0, #255
 728 0016 FFF7FEFF 		bl	xchg_spi
 729              	.LVL66:
 216:FATFS/Target/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 730              		.loc 1 216 9 discriminator 2 view .LVU169
 731 001a 0D4B     		ldr	r3, .L67
 732 001c 1870     		strb	r0, [r3]
 218:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFE)
 733              		.loc 1 218 10 is_stmt 1 discriminator 2 view .LVU170
 218:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFE)
 734              		.loc 1 218 2 is_stmt 0 discriminator 2 view .LVU171
 735 001e FF28     		cmp	r0, #255
 736 0020 03D1     		bne	.L61
 218:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFE)
 737              		.loc 1 218 30 discriminator 1 view .LVU172
 738 0022 FFF7FEFF 		bl	SPI_Timer_Status
 739              	.LVL67:
 218:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFE)
 740              		.loc 1 218 27 discriminator 1 view .LVU173
 741 0026 0028     		cmp	r0, #0
 742 0028 F4D1     		bne	.L62
 743              	.L61:
 219:FATFS/Target/user_diskio_spi.c **** 		return 0; /* Function fails if invalid DataStart token or timeout */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 21


 744              		.loc 1 219 2 is_stmt 1 view .LVU174
 219:FATFS/Target/user_diskio_spi.c **** 		return 0; /* Function fails if invalid DataStart token or timeout */
 745              		.loc 1 219 12 is_stmt 0 view .LVU175
 746 002a 094B     		ldr	r3, .L67
 747 002c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 219:FATFS/Target/user_diskio_spi.c **** 		return 0; /* Function fails if invalid DataStart token or timeout */
 748              		.loc 1 219 5 view .LVU176
 749 002e FE2B     		cmp	r3, #254
 750 0030 01D0     		beq	.L66
 220:FATFS/Target/user_diskio_spi.c **** 
 751              		.loc 1 220 10 view .LVU177
 752 0032 0020     		movs	r0, #0
 753              	.L60:
 227:FATFS/Target/user_diskio_spi.c **** 
 754              		.loc 1 227 1 view .LVU178
 755 0034 38BD     		pop	{r3, r4, r5, pc}
 756              	.LVL68:
 757              	.L66:
 222:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF);
 758              		.loc 1 222 2 is_stmt 1 view .LVU179
 759 0036 2946     		mov	r1, r5
 760 0038 2046     		mov	r0, r4
 761 003a FFF7FEFF 		bl	rcvr_spi_multi
 762              	.LVL69:
 223:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); /* Discard CRC */
 763              		.loc 1 223 2 view .LVU180
 764 003e FF20     		movs	r0, #255
 765 0040 FFF7FEFF 		bl	xchg_spi
 766              	.LVL70:
 224:FATFS/Target/user_diskio_spi.c **** 
 767              		.loc 1 224 2 view .LVU181
 768 0044 FF20     		movs	r0, #255
 769 0046 FFF7FEFF 		bl	xchg_spi
 770              	.LVL71:
 226:FATFS/Target/user_diskio_spi.c **** }
 771              		.loc 1 226 2 view .LVU182
 226:FATFS/Target/user_diskio_spi.c **** }
 772              		.loc 1 226 9 is_stmt 0 view .LVU183
 773 004a 0120     		movs	r0, #1
 774 004c F2E7     		b	.L60
 775              	.L68:
 776 004e 00BF     		.align	2
 777              	.L67:
 778 0050 00000000 		.word	.LANCHOR4
 779              		.cfi_endproc
 780              	.LFE140:
 782              		.section	.text.USER_SPI_initialize,"ax",%progbits
 783              		.align	1
 784              		.global	USER_SPI_initialize
 785              		.syntax unified
 786              		.thumb
 787              		.thumb_func
 788              		.fpu fpv4-sp-d16
 790              	USER_SPI_initialize:
 791              	.LVL72:
 792              	.LFB143:
 316:FATFS/Target/user_diskio_spi.c **** 
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 22


 317:FATFS/Target/user_diskio_spi.c **** /*--------------------------------------------------------------------------
 318:FATFS/Target/user_diskio_spi.c **** 
 319:FATFS/Target/user_diskio_spi.c ****    Public FatFs Functions (wrapped in user_diskio.c)
 320:FATFS/Target/user_diskio_spi.c **** 
 321:FATFS/Target/user_diskio_spi.c **** ---------------------------------------------------------------------------*/
 322:FATFS/Target/user_diskio_spi.c **** 
 323:FATFS/Target/user_diskio_spi.c **** // The following functions are defined as inline because they aren't the functions that
 324:FATFS/Target/user_diskio_spi.c **** // are passed to FatFs - they are wrapped by autogenerated (non-inline) cubemx template
 325:FATFS/Target/user_diskio_spi.c **** // code.
 326:FATFS/Target/user_diskio_spi.c **** // If you do not wish to use cubemx, remove the "inline" from these functions here
 327:FATFS/Target/user_diskio_spi.c **** // and in the associated .h
 328:FATFS/Target/user_diskio_spi.c **** 
 329:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 330:FATFS/Target/user_diskio_spi.c **** /* Initialize disk drive                                                 */
 331:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 332:FATFS/Target/user_diskio_spi.c **** 
 333:FATFS/Target/user_diskio_spi.c **** inline DSTATUS USER_SPI_initialize(
 334:FATFS/Target/user_diskio_spi.c **** 	BYTE drv /* Physical drive number (0) */
 335:FATFS/Target/user_diskio_spi.c **** )
 336:FATFS/Target/user_diskio_spi.c **** {
 793              		.loc 1 336 1 is_stmt 1 view -0
 794              		.cfi_startproc
 795              		@ args = 0, pretend = 0, frame = 8
 796              		@ frame_needed = 0, uses_anonymous_args = 0
 337:FATFS/Target/user_diskio_spi.c **** 	BYTE n, cmd, ty, ocr[4];
 797              		.loc 1 337 2 view .LVU185
 338:FATFS/Target/user_diskio_spi.c **** 
 339:FATFS/Target/user_diskio_spi.c **** 	if (drv != 0)
 798              		.loc 1 339 2 view .LVU186
 799              		.loc 1 339 5 is_stmt 0 view .LVU187
 800 0000 0028     		cmp	r0, #0
 801 0002 40F0AA80 		bne	.L87
 340:FATFS/Target/user_diskio_spi.c **** 		return STA_NOINIT; /* Supports only drive 0 */
 341:FATFS/Target/user_diskio_spi.c **** 	// assume SPI already init init_spi();	/* Initialize SPI */
 342:FATFS/Target/user_diskio_spi.c **** 
 343:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NODISK)
 802              		.loc 1 343 2 is_stmt 1 view .LVU188
 803              		.loc 1 343 11 is_stmt 0 view .LVU189
 804 0006 564B     		ldr	r3, .L103
 805 0008 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 806              		.loc 1 343 5 view .LVU190
 807 000a 13F0020F 		tst	r3, #2
 808 000e 0BD1     		bne	.L97
 336:FATFS/Target/user_diskio_spi.c **** 	BYTE n, cmd, ty, ocr[4];
 809              		.loc 1 336 1 view .LVU191
 810 0010 70B5     		push	{r4, r5, r6, lr}
 811              	.LCFI13:
 812              		.cfi_def_cfa_offset 16
 813              		.cfi_offset 4, -16
 814              		.cfi_offset 5, -12
 815              		.cfi_offset 6, -8
 816              		.cfi_offset 14, -4
 817 0012 82B0     		sub	sp, sp, #8
 818              	.LCFI14:
 819              		.cfi_def_cfa_offset 24
 344:FATFS/Target/user_diskio_spi.c **** 		return Stat; /* Is card existing in the soket? */
 345:FATFS/Target/user_diskio_spi.c **** 
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 23


 346:FATFS/Target/user_diskio_spi.c **** 	FCLK_SLOW();
 820              		.loc 1 346 2 is_stmt 1 view .LVU192
 821 0014 534B     		ldr	r3, .L103+4
 822 0016 1A68     		ldr	r2, [r3]
 823 0018 1368     		ldr	r3, [r2]
 824 001a 23F03803 		bic	r3, r3, #56
 825 001e 43F03003 		orr	r3, r3, #48
 826 0022 1360     		str	r3, [r2]
 827              		.loc 1 346 13 view .LVU193
 347:FATFS/Target/user_diskio_spi.c **** 	for (n = 10; n; n--)
 828              		.loc 1 347 2 view .LVU194
 829              	.LVL73:
 830              		.loc 1 347 9 is_stmt 0 view .LVU195
 831 0024 0A24     		movs	r4, #10
 832              		.loc 1 347 2 view .LVU196
 833 0026 08E0     		b	.L72
 834              	.LVL74:
 835              	.L97:
 836              	.LCFI15:
 837              		.cfi_def_cfa_offset 0
 838              		.cfi_restore 4
 839              		.cfi_restore 5
 840              		.cfi_restore 6
 841              		.cfi_restore 14
 344:FATFS/Target/user_diskio_spi.c **** 		return Stat; /* Is card existing in the soket? */
 842              		.loc 1 344 3 is_stmt 1 view .LVU197
 344:FATFS/Target/user_diskio_spi.c **** 		return Stat; /* Is card existing in the soket? */
 843              		.loc 1 344 10 is_stmt 0 view .LVU198
 844 0028 4D4B     		ldr	r3, .L103
 845 002a 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 846              	.LVL75:
 344:FATFS/Target/user_diskio_spi.c **** 		return Stat; /* Is card existing in the soket? */
 847              		.loc 1 344 10 view .LVU199
 848 002c C0B2     		uxtb	r0, r0
 849 002e 7047     		bx	lr
 850              	.LVL76:
 851              	.L73:
 852              	.LCFI16:
 853              		.cfi_def_cfa_offset 24
 854              		.cfi_offset 4, -16
 855              		.cfi_offset 5, -12
 856              		.cfi_offset 6, -8
 857              		.cfi_offset 14, -4
 348:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(0xFF); /* Send 80 dummy clocks */
 858              		.loc 1 348 3 is_stmt 1 discriminator 3 view .LVU200
 859 0030 FF20     		movs	r0, #255
 860 0032 FFF7FEFF 		bl	xchg_spi
 861              	.LVL77:
 347:FATFS/Target/user_diskio_spi.c **** 	for (n = 10; n; n--)
 862              		.loc 1 347 18 discriminator 3 view .LVU201
 347:FATFS/Target/user_diskio_spi.c **** 	for (n = 10; n; n--)
 863              		.loc 1 347 19 is_stmt 0 discriminator 3 view .LVU202
 864 0036 013C     		subs	r4, r4, #1
 865              	.LVL78:
 347:FATFS/Target/user_diskio_spi.c **** 	for (n = 10; n; n--)
 866              		.loc 1 347 19 discriminator 3 view .LVU203
 867 0038 E4B2     		uxtb	r4, r4
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 24


 868              	.LVL79:
 869              	.L72:
 347:FATFS/Target/user_diskio_spi.c **** 	for (n = 10; n; n--)
 870              		.loc 1 347 15 is_stmt 1 discriminator 1 view .LVU204
 347:FATFS/Target/user_diskio_spi.c **** 	for (n = 10; n; n--)
 871              		.loc 1 347 2 is_stmt 0 discriminator 1 view .LVU205
 872 003a 002C     		cmp	r4, #0
 873 003c F8D1     		bne	.L73
 349:FATFS/Target/user_diskio_spi.c **** 
 350:FATFS/Target/user_diskio_spi.c **** 	ty = 0;
 874              		.loc 1 350 2 is_stmt 1 view .LVU206
 875              	.LVL80:
 351:FATFS/Target/user_diskio_spi.c **** 	if (send_cmd(CMD0, 0) == 1)
 876              		.loc 1 351 2 view .LVU207
 877              		.loc 1 351 6 is_stmt 0 view .LVU208
 878 003e 0021     		movs	r1, #0
 879 0040 0846     		mov	r0, r1
 880 0042 FFF7FEFF 		bl	send_cmd
 881              	.LVL81:
 882 0046 0546     		mov	r5, r0
 883              		.loc 1 351 5 view .LVU209
 884 0048 0128     		cmp	r0, #1
 885 004a 17D0     		beq	.L98
 886              	.LVL82:
 887              	.L74:
 352:FATFS/Target/user_diskio_spi.c **** 	{						/* Put the card SPI/Idle state */
 353:FATFS/Target/user_diskio_spi.c **** 		SPI_Timer_On(1000); /* Initialization timeout = 1 sec */
 354:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD8, 0x1AA) == 1)
 355:FATFS/Target/user_diskio_spi.c **** 		{ /* SDv2? */
 356:FATFS/Target/user_diskio_spi.c **** 			for (n = 0; n < 4; n++)
 357:FATFS/Target/user_diskio_spi.c **** 				ocr[n] = xchg_spi(0xFF); /* Get 32 bit return value of R7 resp */
 358:FATFS/Target/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA)
 359:FATFS/Target/user_diskio_spi.c **** 			{ /* Is the card supports vcc of 2.7-3.6V? */
 360:FATFS/Target/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30))
 361:FATFS/Target/user_diskio_spi.c **** 					; /* Wait for end of initialization with ACMD41(HCS) */
 362:FATFS/Target/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0)
 363:FATFS/Target/user_diskio_spi.c **** 				{ /* Check CCS bit in the OCR */
 364:FATFS/Target/user_diskio_spi.c **** 					for (n = 0; n < 4; n++)
 365:FATFS/Target/user_diskio_spi.c **** 						ocr[n] = xchg_spi(0xFF);
 366:FATFS/Target/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2; /* Card id SDv2 */
 367:FATFS/Target/user_diskio_spi.c **** 				}
 368:FATFS/Target/user_diskio_spi.c **** 			}
 369:FATFS/Target/user_diskio_spi.c **** 		}
 370:FATFS/Target/user_diskio_spi.c **** 		else
 371:FATFS/Target/user_diskio_spi.c **** 		{ /* Not SDv2 card */
 372:FATFS/Target/user_diskio_spi.c **** 			if (send_cmd(ACMD41, 0) <= 1)
 373:FATFS/Target/user_diskio_spi.c **** 			{ /* SDv1 or MMC? */
 374:FATFS/Target/user_diskio_spi.c **** 				ty = CT_SD1;
 375:FATFS/Target/user_diskio_spi.c **** 				cmd = ACMD41; /* SDv1 (ACMD41(0)) */
 376:FATFS/Target/user_diskio_spi.c **** 			}
 377:FATFS/Target/user_diskio_spi.c **** 			else
 378:FATFS/Target/user_diskio_spi.c **** 			{
 379:FATFS/Target/user_diskio_spi.c **** 				ty = CT_MMC;
 380:FATFS/Target/user_diskio_spi.c **** 				cmd = CMD1; /* MMCv3 (CMD1(0)) */
 381:FATFS/Target/user_diskio_spi.c **** 			}
 382:FATFS/Target/user_diskio_spi.c **** 			while (SPI_Timer_Status() && send_cmd(cmd, 0))
 383:FATFS/Target/user_diskio_spi.c **** 				;												  /* Wait for end of initialization */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 25


 384:FATFS/Target/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0) /* Set block length: 512 */
 385:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 386:FATFS/Target/user_diskio_spi.c **** 		}
 387:FATFS/Target/user_diskio_spi.c **** 	}
 388:FATFS/Target/user_diskio_spi.c **** 	CardType = ty; /* Card type */
 888              		.loc 1 388 2 is_stmt 1 view .LVU210
 889              		.loc 1 388 11 is_stmt 0 view .LVU211
 890 004c 464B     		ldr	r3, .L103+8
 891 004e 1C70     		strb	r4, [r3]
 389:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 892              		.loc 1 389 2 is_stmt 1 view .LVU212
 893 0050 FFF7FEFF 		bl	despiselect
 894              	.LVL83:
 390:FATFS/Target/user_diskio_spi.c **** 
 391:FATFS/Target/user_diskio_spi.c **** 	if (ty)
 895              		.loc 1 391 2 view .LVU213
 896              		.loc 1 391 5 is_stmt 0 view .LVU214
 897 0054 002C     		cmp	r4, #0
 898 0056 7CD0     		beq	.L85
 392:FATFS/Target/user_diskio_spi.c **** 	{						 /* OK */
 393:FATFS/Target/user_diskio_spi.c **** 		FCLK_FAST();		 /* Set fast clock */
 899              		.loc 1 393 3 is_stmt 1 view .LVU215
 900 0058 424B     		ldr	r3, .L103+4
 901 005a 1A68     		ldr	r2, [r3]
 902 005c 1368     		ldr	r3, [r2]
 903 005e 23F03803 		bic	r3, r3, #56
 904 0062 43F01003 		orr	r3, r3, #16
 905 0066 1360     		str	r3, [r2]
 906              		.loc 1 393 14 view .LVU216
 394:FATFS/Target/user_diskio_spi.c **** 		Stat &= ~STA_NOINIT; /* Clear STA_NOINIT flag */
 907              		.loc 1 394 3 view .LVU217
 908              		.loc 1 394 8 is_stmt 0 view .LVU218
 909 0068 3D4A     		ldr	r2, .L103
 910 006a 1378     		ldrb	r3, [r2]	@ zero_extendqisi2
 911 006c 03F0FE03 		and	r3, r3, #254
 912 0070 1370     		strb	r3, [r2]
 913              	.L86:
 395:FATFS/Target/user_diskio_spi.c **** 	}
 396:FATFS/Target/user_diskio_spi.c **** 	else
 397:FATFS/Target/user_diskio_spi.c **** 	{ /* Failed */
 398:FATFS/Target/user_diskio_spi.c **** 		Stat = STA_NOINIT;
 399:FATFS/Target/user_diskio_spi.c **** 	}
 400:FATFS/Target/user_diskio_spi.c **** 
 401:FATFS/Target/user_diskio_spi.c **** 	return Stat;
 914              		.loc 1 401 2 is_stmt 1 view .LVU219
 915              		.loc 1 401 9 is_stmt 0 view .LVU220
 916 0072 3B4B     		ldr	r3, .L103
 917 0074 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 918 0076 C0B2     		uxtb	r0, r0
 402:FATFS/Target/user_diskio_spi.c **** }
 919              		.loc 1 402 1 view .LVU221
 920 0078 02B0     		add	sp, sp, #8
 921              	.LCFI17:
 922              		.cfi_remember_state
 923              		.cfi_def_cfa_offset 16
 924              		@ sp needed
 925 007a 70BD     		pop	{r4, r5, r6, pc}
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 26


 926              	.LVL84:
 927              	.L98:
 928              	.LCFI18:
 929              		.cfi_restore_state
 353:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD8, 0x1AA) == 1)
 930              		.loc 1 353 3 is_stmt 1 view .LVU222
 931 007c 4FF47A70 		mov	r0, #1000
 932 0080 FFF7FEFF 		bl	SPI_Timer_On
 933              	.LVL85:
 354:FATFS/Target/user_diskio_spi.c **** 		{ /* SDv2? */
 934              		.loc 1 354 3 view .LVU223
 354:FATFS/Target/user_diskio_spi.c **** 		{ /* SDv2? */
 935              		.loc 1 354 7 is_stmt 0 view .LVU224
 936 0084 4FF4D571 		mov	r1, #426
 937 0088 0820     		movs	r0, #8
 938 008a FFF7FEFF 		bl	send_cmd
 939              	.LVL86:
 354:FATFS/Target/user_diskio_spi.c **** 		{ /* SDv2? */
 940              		.loc 1 354 6 view .LVU225
 941 008e 0128     		cmp	r0, #1
 942 0090 3CD1     		bne	.L99
 356:FATFS/Target/user_diskio_spi.c **** 				ocr[n] = xchg_spi(0xFF); /* Get 32 bit return value of R7 resp */
 943              		.loc 1 356 11 view .LVU226
 944 0092 2546     		mov	r5, r4
 945 0094 08E0     		b	.L75
 946              	.LVL87:
 947              	.L77:
 357:FATFS/Target/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA)
 948              		.loc 1 357 5 is_stmt 1 discriminator 3 view .LVU227
 357:FATFS/Target/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA)
 949              		.loc 1 357 14 is_stmt 0 discriminator 3 view .LVU228
 950 0096 FF20     		movs	r0, #255
 951 0098 FFF7FEFF 		bl	xchg_spi
 952              	.LVL88:
 357:FATFS/Target/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA)
 953              		.loc 1 357 12 discriminator 3 view .LVU229
 954 009c 02AB     		add	r3, sp, #8
 955 009e 2B44     		add	r3, r3, r5
 956 00a0 03F8040C 		strb	r0, [r3, #-4]
 356:FATFS/Target/user_diskio_spi.c **** 				ocr[n] = xchg_spi(0xFF); /* Get 32 bit return value of R7 resp */
 957              		.loc 1 356 23 is_stmt 1 discriminator 3 view .LVU230
 356:FATFS/Target/user_diskio_spi.c **** 				ocr[n] = xchg_spi(0xFF); /* Get 32 bit return value of R7 resp */
 958              		.loc 1 356 24 is_stmt 0 discriminator 3 view .LVU231
 959 00a4 0135     		adds	r5, r5, #1
 960              	.LVL89:
 356:FATFS/Target/user_diskio_spi.c **** 				ocr[n] = xchg_spi(0xFF); /* Get 32 bit return value of R7 resp */
 961              		.loc 1 356 24 discriminator 3 view .LVU232
 962 00a6 EDB2     		uxtb	r5, r5
 963              	.LVL90:
 964              	.L75:
 356:FATFS/Target/user_diskio_spi.c **** 				ocr[n] = xchg_spi(0xFF); /* Get 32 bit return value of R7 resp */
 965              		.loc 1 356 16 is_stmt 1 discriminator 1 view .LVU233
 356:FATFS/Target/user_diskio_spi.c **** 				ocr[n] = xchg_spi(0xFF); /* Get 32 bit return value of R7 resp */
 966              		.loc 1 356 4 is_stmt 0 discriminator 1 view .LVU234
 967 00a8 032D     		cmp	r5, #3
 968 00aa F4D9     		bls	.L77
 358:FATFS/Target/user_diskio_spi.c **** 			{ /* Is the card supports vcc of 2.7-3.6V? */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 27


 969              		.loc 1 358 4 is_stmt 1 view .LVU235
 358:FATFS/Target/user_diskio_spi.c **** 			{ /* Is the card supports vcc of 2.7-3.6V? */
 970              		.loc 1 358 11 is_stmt 0 view .LVU236
 971 00ac 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 358:FATFS/Target/user_diskio_spi.c **** 			{ /* Is the card supports vcc of 2.7-3.6V? */
 972              		.loc 1 358 7 view .LVU237
 973 00b0 012B     		cmp	r3, #1
 974 00b2 CBD1     		bne	.L74
 358:FATFS/Target/user_diskio_spi.c **** 			{ /* Is the card supports vcc of 2.7-3.6V? */
 975              		.loc 1 358 29 discriminator 1 view .LVU238
 976 00b4 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 358:FATFS/Target/user_diskio_spi.c **** 			{ /* Is the card supports vcc of 2.7-3.6V? */
 977              		.loc 1 358 23 discriminator 1 view .LVU239
 978 00b8 AA2B     		cmp	r3, #170
 979 00ba C7D1     		bne	.L74
 980              	.L79:
 361:FATFS/Target/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0)
 981              		.loc 1 361 6 is_stmt 1 discriminator 2 view .LVU240
 360:FATFS/Target/user_diskio_spi.c **** 					; /* Wait for end of initialization with ACMD41(HCS) */
 982              		.loc 1 360 11 discriminator 2 view .LVU241
 360:FATFS/Target/user_diskio_spi.c **** 					; /* Wait for end of initialization with ACMD41(HCS) */
 983              		.loc 1 360 12 is_stmt 0 discriminator 2 view .LVU242
 984 00bc FFF7FEFF 		bl	SPI_Timer_Status
 985              	.LVL91:
 360:FATFS/Target/user_diskio_spi.c **** 					; /* Wait for end of initialization with ACMD41(HCS) */
 986              		.loc 1 360 11 discriminator 2 view .LVU243
 987 00c0 30B1     		cbz	r0, .L78
 360:FATFS/Target/user_diskio_spi.c **** 					; /* Wait for end of initialization with ACMD41(HCS) */
 988              		.loc 1 360 34 discriminator 1 view .LVU244
 989 00c2 4FF08041 		mov	r1, #1073741824
 990 00c6 A920     		movs	r0, #169
 991 00c8 FFF7FEFF 		bl	send_cmd
 992              	.LVL92:
 360:FATFS/Target/user_diskio_spi.c **** 					; /* Wait for end of initialization with ACMD41(HCS) */
 993              		.loc 1 360 31 discriminator 1 view .LVU245
 994 00cc 0028     		cmp	r0, #0
 995 00ce F5D1     		bne	.L79
 996              	.L78:
 362:FATFS/Target/user_diskio_spi.c **** 				{ /* Check CCS bit in the OCR */
 997              		.loc 1 362 5 is_stmt 1 view .LVU246
 362:FATFS/Target/user_diskio_spi.c **** 				{ /* Check CCS bit in the OCR */
 998              		.loc 1 362 9 is_stmt 0 view .LVU247
 999 00d0 FFF7FEFF 		bl	SPI_Timer_Status
 1000              	.LVL93:
 362:FATFS/Target/user_diskio_spi.c **** 				{ /* Check CCS bit in the OCR */
 1001              		.loc 1 362 8 view .LVU248
 1002 00d4 08B9     		cbnz	r0, .L100
 350:FATFS/Target/user_diskio_spi.c **** 	if (send_cmd(CMD0, 0) == 1)
 1003              		.loc 1 350 5 view .LVU249
 1004 00d6 0446     		mov	r4, r0
 1005 00d8 B8E7     		b	.L74
 1006              	.L100:
 362:FATFS/Target/user_diskio_spi.c **** 				{ /* Check CCS bit in the OCR */
 1007              		.loc 1 362 31 discriminator 1 view .LVU250
 1008 00da 0021     		movs	r1, #0
 1009 00dc 3A20     		movs	r0, #58
 1010 00de FFF7FEFF 		bl	send_cmd
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 28


 1011              	.LVL94:
 362:FATFS/Target/user_diskio_spi.c **** 				{ /* Check CCS bit in the OCR */
 1012              		.loc 1 362 28 discriminator 1 view .LVU251
 1013 00e2 0546     		mov	r5, r0
 1014              	.LVL95:
 362:FATFS/Target/user_diskio_spi.c **** 				{ /* Check CCS bit in the OCR */
 1015              		.loc 1 362 28 discriminator 1 view .LVU252
 1016 00e4 48B1     		cbz	r0, .L80
 1017 00e6 B1E7     		b	.L74
 1018              	.LVL96:
 1019              	.L81:
 365:FATFS/Target/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2; /* Card id SDv2 */
 1020              		.loc 1 365 7 is_stmt 1 discriminator 3 view .LVU253
 365:FATFS/Target/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2; /* Card id SDv2 */
 1021              		.loc 1 365 16 is_stmt 0 discriminator 3 view .LVU254
 1022 00e8 FF20     		movs	r0, #255
 1023 00ea FFF7FEFF 		bl	xchg_spi
 1024              	.LVL97:
 365:FATFS/Target/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2; /* Card id SDv2 */
 1025              		.loc 1 365 14 discriminator 3 view .LVU255
 1026 00ee 02AB     		add	r3, sp, #8
 1027 00f0 2B44     		add	r3, r3, r5
 1028 00f2 03F8040C 		strb	r0, [r3, #-4]
 364:FATFS/Target/user_diskio_spi.c **** 						ocr[n] = xchg_spi(0xFF);
 1029              		.loc 1 364 25 is_stmt 1 discriminator 3 view .LVU256
 364:FATFS/Target/user_diskio_spi.c **** 						ocr[n] = xchg_spi(0xFF);
 1030              		.loc 1 364 26 is_stmt 0 discriminator 3 view .LVU257
 1031 00f6 0135     		adds	r5, r5, #1
 1032              	.LVL98:
 364:FATFS/Target/user_diskio_spi.c **** 						ocr[n] = xchg_spi(0xFF);
 1033              		.loc 1 364 26 discriminator 3 view .LVU258
 1034 00f8 EDB2     		uxtb	r5, r5
 1035              	.LVL99:
 1036              	.L80:
 364:FATFS/Target/user_diskio_spi.c **** 						ocr[n] = xchg_spi(0xFF);
 1037              		.loc 1 364 18 is_stmt 1 discriminator 1 view .LVU259
 364:FATFS/Target/user_diskio_spi.c **** 						ocr[n] = xchg_spi(0xFF);
 1038              		.loc 1 364 6 is_stmt 0 discriminator 1 view .LVU260
 1039 00fa 032D     		cmp	r5, #3
 1040 00fc F4D9     		bls	.L81
 366:FATFS/Target/user_diskio_spi.c **** 				}
 1041              		.loc 1 366 6 is_stmt 1 view .LVU261
 366:FATFS/Target/user_diskio_spi.c **** 				}
 1042              		.loc 1 366 15 is_stmt 0 view .LVU262
 1043 00fe 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 366:FATFS/Target/user_diskio_spi.c **** 				}
 1044              		.loc 1 366 9 view .LVU263
 1045 0102 13F0400F 		tst	r3, #64
 1046 0106 22D0     		beq	.L90
 1047 0108 0C24     		movs	r4, #12
 1048 010a 9FE7     		b	.L74
 1049              	.LVL100:
 1050              	.L99:
 372:FATFS/Target/user_diskio_spi.c **** 			{ /* SDv1 or MMC? */
 1051              		.loc 1 372 4 is_stmt 1 view .LVU264
 372:FATFS/Target/user_diskio_spi.c **** 			{ /* SDv1 or MMC? */
 1052              		.loc 1 372 8 is_stmt 0 view .LVU265
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 29


 1053 010c 0021     		movs	r1, #0
 1054 010e A920     		movs	r0, #169
 1055 0110 FFF7FEFF 		bl	send_cmd
 1056              	.LVL101:
 372:FATFS/Target/user_diskio_spi.c **** 			{ /* SDv1 or MMC? */
 1057              		.loc 1 372 7 view .LVU266
 1058 0114 0128     		cmp	r0, #1
 1059 0116 0ED9     		bls	.L101
 379:FATFS/Target/user_diskio_spi.c **** 				cmd = CMD1; /* MMCv3 (CMD1(0)) */
 1060              		.loc 1 379 8 view .LVU267
 1061 0118 2E46     		mov	r6, r5
 1062              	.LVL102:
 1063              	.L84:
 383:FATFS/Target/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0) /* Set block length: 512 */
 1064              		.loc 1 383 5 is_stmt 1 discriminator 2 view .LVU268
 382:FATFS/Target/user_diskio_spi.c **** 				;												  /* Wait for end of initialization */
 1065              		.loc 1 382 10 discriminator 2 view .LVU269
 382:FATFS/Target/user_diskio_spi.c **** 				;												  /* Wait for end of initialization */
 1066              		.loc 1 382 11 is_stmt 0 discriminator 2 view .LVU270
 1067 011a FFF7FEFF 		bl	SPI_Timer_Status
 1068              	.LVL103:
 382:FATFS/Target/user_diskio_spi.c **** 				;												  /* Wait for end of initialization */
 1069              		.loc 1 382 10 discriminator 2 view .LVU271
 1070 011e 28B1     		cbz	r0, .L83
 382:FATFS/Target/user_diskio_spi.c **** 				;												  /* Wait for end of initialization */
 1071              		.loc 1 382 33 discriminator 1 view .LVU272
 1072 0120 0021     		movs	r1, #0
 1073 0122 2846     		mov	r0, r5
 1074 0124 FFF7FEFF 		bl	send_cmd
 1075              	.LVL104:
 382:FATFS/Target/user_diskio_spi.c **** 				;												  /* Wait for end of initialization */
 1076              		.loc 1 382 30 discriminator 1 view .LVU273
 1077 0128 0028     		cmp	r0, #0
 1078 012a F6D1     		bne	.L84
 1079              	.L83:
 384:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1080              		.loc 1 384 4 is_stmt 1 view .LVU274
 384:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1081              		.loc 1 384 9 is_stmt 0 view .LVU275
 1082 012c FFF7FEFF 		bl	SPI_Timer_Status
 1083              	.LVL105:
 384:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1084              		.loc 1 384 7 view .LVU276
 1085 0130 20B9     		cbnz	r0, .L102
 385:FATFS/Target/user_diskio_spi.c **** 		}
 1086              		.loc 1 385 8 view .LVU277
 1087 0132 0446     		mov	r4, r0
 1088              	.LVL106:
 385:FATFS/Target/user_diskio_spi.c **** 		}
 1089              		.loc 1 385 8 view .LVU278
 1090 0134 8AE7     		b	.L74
 1091              	.LVL107:
 1092              	.L101:
 374:FATFS/Target/user_diskio_spi.c **** 				cmd = ACMD41; /* SDv1 (ACMD41(0)) */
 1093              		.loc 1 374 8 view .LVU279
 1094 0136 0226     		movs	r6, #2
 375:FATFS/Target/user_diskio_spi.c **** 			}
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 30


 1095              		.loc 1 375 9 view .LVU280
 1096 0138 A925     		movs	r5, #169
 1097 013a EEE7     		b	.L84
 1098              	.LVL108:
 1099              	.L102:
 384:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1100              		.loc 1 384 31 discriminator 1 view .LVU281
 1101 013c 4FF40071 		mov	r1, #512
 1102 0140 1020     		movs	r0, #16
 1103 0142 FFF7FEFF 		bl	send_cmd
 1104              	.LVL109:
 384:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1105              		.loc 1 384 28 discriminator 1 view .LVU282
 1106 0146 0028     		cmp	r0, #0
 1107 0148 80D1     		bne	.L74
 384:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1108              		.loc 1 384 28 view .LVU283
 1109 014a 3446     		mov	r4, r6
 1110              	.LVL110:
 384:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1111              		.loc 1 384 28 view .LVU284
 1112 014c 7EE7     		b	.L74
 1113              	.LVL111:
 1114              	.L90:
 366:FATFS/Target/user_diskio_spi.c **** 				}
 1115              		.loc 1 366 9 view .LVU285
 1116 014e 0424     		movs	r4, #4
 1117 0150 7CE7     		b	.L74
 1118              	.LVL112:
 1119              	.L85:
 398:FATFS/Target/user_diskio_spi.c **** 	}
 1120              		.loc 1 398 3 is_stmt 1 view .LVU286
 398:FATFS/Target/user_diskio_spi.c **** 	}
 1121              		.loc 1 398 8 is_stmt 0 view .LVU287
 1122 0152 034B     		ldr	r3, .L103
 1123 0154 0122     		movs	r2, #1
 1124 0156 1A70     		strb	r2, [r3]
 1125 0158 8BE7     		b	.L86
 1126              	.LVL113:
 1127              	.L87:
 1128              	.LCFI19:
 1129              		.cfi_def_cfa_offset 0
 1130              		.cfi_restore 4
 1131              		.cfi_restore 5
 1132              		.cfi_restore 6
 1133              		.cfi_restore 14
 340:FATFS/Target/user_diskio_spi.c **** 	// assume SPI already init init_spi();	/* Initialize SPI */
 1134              		.loc 1 340 10 view .LVU288
 1135 015a 0120     		movs	r0, #1
 1136              	.LVL114:
 1137              		.loc 1 402 1 view .LVU289
 1138 015c 7047     		bx	lr
 1139              	.L104:
 1140 015e 00BF     		.align	2
 1141              	.L103:
 1142 0160 00000000 		.word	.LANCHOR5
 1143 0164 00000000 		.word	hspi2
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 31


 1144 0168 00000000 		.word	.LANCHOR6
 1145              		.cfi_endproc
 1146              	.LFE143:
 1148              		.section	.text.USER_SPI_status,"ax",%progbits
 1149              		.align	1
 1150              		.global	USER_SPI_status
 1151              		.syntax unified
 1152              		.thumb
 1153              		.thumb_func
 1154              		.fpu fpv4-sp-d16
 1156              	USER_SPI_status:
 1157              	.LVL115:
 1158              	.LFB144:
 403:FATFS/Target/user_diskio_spi.c **** 
 404:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 405:FATFS/Target/user_diskio_spi.c **** /* Get disk status                                                       */
 406:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 407:FATFS/Target/user_diskio_spi.c **** 
 408:FATFS/Target/user_diskio_spi.c **** inline DSTATUS USER_SPI_status(
 409:FATFS/Target/user_diskio_spi.c **** 	BYTE drv /* Physical drive number (0) */
 410:FATFS/Target/user_diskio_spi.c **** )
 411:FATFS/Target/user_diskio_spi.c **** {
 1159              		.loc 1 411 1 is_stmt 1 view -0
 1160              		.cfi_startproc
 1161              		@ args = 0, pretend = 0, frame = 0
 1162              		@ frame_needed = 0, uses_anonymous_args = 0
 1163              		@ link register save eliminated.
 412:FATFS/Target/user_diskio_spi.c **** 	if (drv)
 1164              		.loc 1 412 2 view .LVU291
 1165              		.loc 1 412 5 is_stmt 0 view .LVU292
 1166 0000 18B9     		cbnz	r0, .L107
 413:FATFS/Target/user_diskio_spi.c **** 		return STA_NOINIT; /* Supports only drive 0 */
 414:FATFS/Target/user_diskio_spi.c **** 
 415:FATFS/Target/user_diskio_spi.c **** 	return Stat; /* Return disk status */
 1167              		.loc 1 415 2 is_stmt 1 view .LVU293
 1168              		.loc 1 415 9 is_stmt 0 view .LVU294
 1169 0002 034B     		ldr	r3, .L108
 1170 0004 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 1171              	.LVL116:
 1172              		.loc 1 415 9 view .LVU295
 1173 0006 C0B2     		uxtb	r0, r0
 1174 0008 7047     		bx	lr
 1175              	.LVL117:
 1176              	.L107:
 413:FATFS/Target/user_diskio_spi.c **** 		return STA_NOINIT; /* Supports only drive 0 */
 1177              		.loc 1 413 10 view .LVU296
 1178 000a 0120     		movs	r0, #1
 1179              	.LVL118:
 416:FATFS/Target/user_diskio_spi.c **** }
 1180              		.loc 1 416 1 view .LVU297
 1181 000c 7047     		bx	lr
 1182              	.L109:
 1183 000e 00BF     		.align	2
 1184              	.L108:
 1185 0010 00000000 		.word	.LANCHOR5
 1186              		.cfi_endproc
 1187              	.LFE144:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 32


 1189              		.section	.text.USER_SPI_read,"ax",%progbits
 1190              		.align	1
 1191              		.global	USER_SPI_read
 1192              		.syntax unified
 1193              		.thumb
 1194              		.thumb_func
 1195              		.fpu fpv4-sp-d16
 1197              	USER_SPI_read:
 1198              	.LVL119:
 1199              	.LFB145:
 417:FATFS/Target/user_diskio_spi.c **** 
 418:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 419:FATFS/Target/user_diskio_spi.c **** /* Read sector(s)                                                        */
 420:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 421:FATFS/Target/user_diskio_spi.c **** 
 422:FATFS/Target/user_diskio_spi.c **** inline DRESULT USER_SPI_read(
 423:FATFS/Target/user_diskio_spi.c **** 	BYTE drv,	  /* Physical drive number (0) */
 424:FATFS/Target/user_diskio_spi.c **** 	BYTE *buff,	  /* Pointer to the data buffer to store read data */
 425:FATFS/Target/user_diskio_spi.c **** 	DWORD sector, /* Start sector number (LBA) */
 426:FATFS/Target/user_diskio_spi.c **** 	UINT count	  /* Number of sectors to read (1..128) */
 427:FATFS/Target/user_diskio_spi.c **** )
 428:FATFS/Target/user_diskio_spi.c **** {
 1200              		.loc 1 428 1 is_stmt 1 view -0
 1201              		.cfi_startproc
 1202              		@ args = 0, pretend = 0, frame = 0
 1203              		@ frame_needed = 0, uses_anonymous_args = 0
 429:FATFS/Target/user_diskio_spi.c **** 	if (drv || !count)
 1204              		.loc 1 429 2 view .LVU299
 1205              		.loc 1 429 5 is_stmt 0 view .LVU300
 1206 0000 0028     		cmp	r0, #0
 1207 0002 39D1     		bne	.L117
 428:FATFS/Target/user_diskio_spi.c **** 	if (drv || !count)
 1208              		.loc 1 428 1 discriminator 1 view .LVU301
 1209 0004 38B5     		push	{r3, r4, r5, lr}
 1210              	.LCFI20:
 1211              		.cfi_def_cfa_offset 16
 1212              		.cfi_offset 3, -16
 1213              		.cfi_offset 4, -12
 1214              		.cfi_offset 5, -8
 1215              		.cfi_offset 14, -4
 1216 0006 0D46     		mov	r5, r1
 1217 0008 1C46     		mov	r4, r3
 1218              		.loc 1 429 10 discriminator 1 view .LVU302
 1219 000a 002B     		cmp	r3, #0
 1220 000c 36D0     		beq	.L118
 430:FATFS/Target/user_diskio_spi.c **** 		return RES_PARERR; /* Check parameter */
 431:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1221              		.loc 1 431 2 is_stmt 1 view .LVU303
 1222              		.loc 1 431 11 is_stmt 0 view .LVU304
 1223 000e 1D4B     		ldr	r3, .L126
 1224              	.LVL120:
 1225              		.loc 1 431 11 view .LVU305
 1226 0010 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1227              		.loc 1 431 5 view .LVU306
 1228 0012 13F0010F 		tst	r3, #1
 1229 0016 33D1     		bne	.L119
 432:FATFS/Target/user_diskio_spi.c **** 		return RES_NOTRDY; /* Check if drive is ready */
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 33


 433:FATFS/Target/user_diskio_spi.c **** 
 434:FATFS/Target/user_diskio_spi.c **** 	if (!(CardType & CT_BLOCK))
 1230              		.loc 1 434 2 is_stmt 1 view .LVU307
 1231              		.loc 1 434 17 is_stmt 0 view .LVU308
 1232 0018 1B4B     		ldr	r3, .L126+4
 1233 001a 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1234              		.loc 1 434 5 view .LVU309
 1235 001c 13F0080F 		tst	r3, #8
 1236 0020 00D1     		bne	.L112
 435:FATFS/Target/user_diskio_spi.c **** 		sector *= 512; /* LBA ot BA conversion (byte addressing cards) */
 1237              		.loc 1 435 3 is_stmt 1 view .LVU310
 1238              		.loc 1 435 10 is_stmt 0 view .LVU311
 1239 0022 5202     		lsls	r2, r2, #9
 1240              	.LVL121:
 1241              	.L112:
 436:FATFS/Target/user_diskio_spi.c **** 
 437:FATFS/Target/user_diskio_spi.c **** 	if (count == 1)
 1242              		.loc 1 437 2 is_stmt 1 view .LVU312
 1243              		.loc 1 437 5 is_stmt 0 view .LVU313
 1244 0024 012C     		cmp	r4, #1
 1245 0026 18D0     		beq	.L125
 438:FATFS/Target/user_diskio_spi.c **** 	{									   /* Single sector read */
 439:FATFS/Target/user_diskio_spi.c **** 		if ((send_cmd(CMD17, sector) == 0) /* READ_SINGLE_BLOCK */
 440:FATFS/Target/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512))
 441:FATFS/Target/user_diskio_spi.c **** 		{
 442:FATFS/Target/user_diskio_spi.c **** 			count = 0;
 443:FATFS/Target/user_diskio_spi.c **** 		}
 444:FATFS/Target/user_diskio_spi.c **** 	}
 445:FATFS/Target/user_diskio_spi.c **** 	else
 446:FATFS/Target/user_diskio_spi.c **** 	{ /* Multiple sector read */
 447:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD18, sector) == 0)
 1246              		.loc 1 447 3 is_stmt 1 view .LVU314
 1247              		.loc 1 447 7 is_stmt 0 view .LVU315
 1248 0028 1146     		mov	r1, r2
 1249              	.LVL122:
 1250              		.loc 1 447 7 view .LVU316
 1251 002a 1220     		movs	r0, #18
 1252              	.LVL123:
 1253              		.loc 1 447 7 view .LVU317
 1254 002c FFF7FEFF 		bl	send_cmd
 1255              	.LVL124:
 1256              		.loc 1 447 6 view .LVU318
 1257 0030 68B9     		cbnz	r0, .L114
 1258              	.L116:
 448:FATFS/Target/user_diskio_spi.c **** 		{ /* READ_MULTIPLE_BLOCK */
 449:FATFS/Target/user_diskio_spi.c **** 			do
 1259              		.loc 1 449 4 is_stmt 1 view .LVU319
 450:FATFS/Target/user_diskio_spi.c **** 			{
 451:FATFS/Target/user_diskio_spi.c **** 				if (!rcvr_datablock(buff, 512))
 1260              		.loc 1 451 5 view .LVU320
 1261              		.loc 1 451 10 is_stmt 0 view .LVU321
 1262 0032 4FF40071 		mov	r1, #512
 1263 0036 2846     		mov	r0, r5
 1264 0038 FFF7FEFF 		bl	rcvr_datablock
 1265              	.LVL125:
 1266              		.loc 1 451 8 view .LVU322
 1267 003c 18B1     		cbz	r0, .L115
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 34


 452:FATFS/Target/user_diskio_spi.c **** 					break;
 453:FATFS/Target/user_diskio_spi.c **** 				buff += 512;
 1268              		.loc 1 453 5 is_stmt 1 view .LVU323
 1269              		.loc 1 453 10 is_stmt 0 view .LVU324
 1270 003e 05F50075 		add	r5, r5, #512
 1271              	.LVL126:
 454:FATFS/Target/user_diskio_spi.c **** 			} while (--count);
 1272              		.loc 1 454 12 is_stmt 1 view .LVU325
 1273              		.loc 1 454 4 is_stmt 0 view .LVU326
 1274 0042 013C     		subs	r4, r4, #1
 1275              	.LVL127:
 1276              		.loc 1 454 4 view .LVU327
 1277 0044 F5D1     		bne	.L116
 1278              	.L115:
 455:FATFS/Target/user_diskio_spi.c **** 			send_cmd(CMD12, 0); /* STOP_TRANSMISSION */
 1279              		.loc 1 455 4 is_stmt 1 view .LVU328
 1280 0046 0021     		movs	r1, #0
 1281 0048 0C20     		movs	r0, #12
 1282 004a FFF7FEFF 		bl	send_cmd
 1283              	.LVL128:
 1284              	.L114:
 456:FATFS/Target/user_diskio_spi.c **** 		}
 457:FATFS/Target/user_diskio_spi.c **** 	}
 458:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 1285              		.loc 1 458 2 view .LVU329
 1286 004e FFF7FEFF 		bl	despiselect
 1287              	.LVL129:
 459:FATFS/Target/user_diskio_spi.c **** 
 460:FATFS/Target/user_diskio_spi.c **** 	return count ? RES_ERROR : RES_OK; /* Return result */
 1288              		.loc 1 460 2 view .LVU330
 1289              		.loc 1 460 27 is_stmt 0 view .LVU331
 1290 0052 201E     		subs	r0, r4, #0
 1291 0054 18BF     		it	ne
 1292 0056 0120     		movne	r0, #1
 1293              	.L111:
 461:FATFS/Target/user_diskio_spi.c **** }
 1294              		.loc 1 461 1 view .LVU332
 1295 0058 38BD     		pop	{r3, r4, r5, pc}
 1296              	.LVL130:
 1297              	.L125:
 439:FATFS/Target/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512))
 1298              		.loc 1 439 3 is_stmt 1 view .LVU333
 439:FATFS/Target/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512))
 1299              		.loc 1 439 8 is_stmt 0 view .LVU334
 1300 005a 1146     		mov	r1, r2
 1301              	.LVL131:
 439:FATFS/Target/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512))
 1302              		.loc 1 439 8 view .LVU335
 1303 005c 1120     		movs	r0, #17
 1304              	.LVL132:
 439:FATFS/Target/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512))
 1305              		.loc 1 439 8 view .LVU336
 1306 005e FFF7FEFF 		bl	send_cmd
 1307              	.LVL133:
 439:FATFS/Target/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512))
 1308              		.loc 1 439 6 view .LVU337
 1309 0062 0028     		cmp	r0, #0
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 35


 1310 0064 F3D1     		bne	.L114
 440:FATFS/Target/user_diskio_spi.c **** 		{
 1311              		.loc 1 440 7 view .LVU338
 1312 0066 4FF40071 		mov	r1, #512
 1313 006a 2846     		mov	r0, r5
 1314 006c FFF7FEFF 		bl	rcvr_datablock
 1315              	.LVL134:
 440:FATFS/Target/user_diskio_spi.c **** 		{
 1316              		.loc 1 440 4 view .LVU339
 1317 0070 0028     		cmp	r0, #0
 1318 0072 ECD0     		beq	.L114
 442:FATFS/Target/user_diskio_spi.c **** 		}
 1319              		.loc 1 442 10 view .LVU340
 1320 0074 0024     		movs	r4, #0
 1321              	.LVL135:
 442:FATFS/Target/user_diskio_spi.c **** 		}
 1322              		.loc 1 442 10 view .LVU341
 1323 0076 EAE7     		b	.L114
 1324              	.LVL136:
 1325              	.L117:
 1326              	.LCFI21:
 1327              		.cfi_def_cfa_offset 0
 1328              		.cfi_restore 3
 1329              		.cfi_restore 4
 1330              		.cfi_restore 5
 1331              		.cfi_restore 14
 430:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1332              		.loc 1 430 10 view .LVU342
 1333 0078 0420     		movs	r0, #4
 1334              	.LVL137:
 1335              		.loc 1 461 1 view .LVU343
 1336 007a 7047     		bx	lr
 1337              	.LVL138:
 1338              	.L118:
 1339              	.LCFI22:
 1340              		.cfi_def_cfa_offset 16
 1341              		.cfi_offset 3, -16
 1342              		.cfi_offset 4, -12
 1343              		.cfi_offset 5, -8
 1344              		.cfi_offset 14, -4
 430:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1345              		.loc 1 430 10 view .LVU344
 1346 007c 0420     		movs	r0, #4
 1347              	.LVL139:
 430:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1348              		.loc 1 430 10 view .LVU345
 1349 007e EBE7     		b	.L111
 1350              	.LVL140:
 1351              	.L119:
 432:FATFS/Target/user_diskio_spi.c **** 
 1352              		.loc 1 432 10 view .LVU346
 1353 0080 0320     		movs	r0, #3
 1354              	.LVL141:
 432:FATFS/Target/user_diskio_spi.c **** 
 1355              		.loc 1 432 10 view .LVU347
 1356 0082 E9E7     		b	.L111
 1357              	.L127:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 36


 1358              		.align	2
 1359              	.L126:
 1360 0084 00000000 		.word	.LANCHOR5
 1361 0088 00000000 		.word	.LANCHOR6
 1362              		.cfi_endproc
 1363              	.LFE145:
 1365              		.section	.text.USER_SPI_write,"ax",%progbits
 1366              		.align	1
 1367              		.global	USER_SPI_write
 1368              		.syntax unified
 1369              		.thumb
 1370              		.thumb_func
 1371              		.fpu fpv4-sp-d16
 1373              	USER_SPI_write:
 1374              	.LVL142:
 1375              	.LFB146:
 462:FATFS/Target/user_diskio_spi.c **** 
 463:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 464:FATFS/Target/user_diskio_spi.c **** /* Write sector(s)                                                       */
 465:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 466:FATFS/Target/user_diskio_spi.c **** 
 467:FATFS/Target/user_diskio_spi.c **** #if _USE_WRITE
 468:FATFS/Target/user_diskio_spi.c **** inline DRESULT USER_SPI_write(
 469:FATFS/Target/user_diskio_spi.c **** 	BYTE drv,		  /* Physical drive number (0) */
 470:FATFS/Target/user_diskio_spi.c **** 	const BYTE *buff, /* Ponter to the data to write */
 471:FATFS/Target/user_diskio_spi.c **** 	DWORD sector,	  /* Start sector number (LBA) */
 472:FATFS/Target/user_diskio_spi.c **** 	UINT count		  /* Number of sectors to write (1..128) */
 473:FATFS/Target/user_diskio_spi.c **** )
 474:FATFS/Target/user_diskio_spi.c **** {
 1376              		.loc 1 474 1 is_stmt 1 view -0
 1377              		.cfi_startproc
 1378              		@ args = 0, pretend = 0, frame = 0
 1379              		@ frame_needed = 0, uses_anonymous_args = 0
 475:FATFS/Target/user_diskio_spi.c **** 	if (drv || !count)
 1380              		.loc 1 475 2 view .LVU349
 1381              		.loc 1 475 5 is_stmt 0 view .LVU350
 1382 0000 0028     		cmp	r0, #0
 1383 0002 48D1     		bne	.L136
 474:FATFS/Target/user_diskio_spi.c **** 	if (drv || !count)
 1384              		.loc 1 474 1 discriminator 1 view .LVU351
 1385 0004 70B5     		push	{r4, r5, r6, lr}
 1386              	.LCFI23:
 1387              		.cfi_def_cfa_offset 16
 1388              		.cfi_offset 4, -16
 1389              		.cfi_offset 5, -12
 1390              		.cfi_offset 6, -8
 1391              		.cfi_offset 14, -4
 1392 0006 0D46     		mov	r5, r1
 1393 0008 1646     		mov	r6, r2
 1394 000a 1C46     		mov	r4, r3
 1395              		.loc 1 475 10 discriminator 1 view .LVU352
 1396 000c 002B     		cmp	r3, #0
 1397 000e 44D0     		beq	.L137
 476:FATFS/Target/user_diskio_spi.c **** 		return RES_PARERR; /* Check parameter */
 477:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1398              		.loc 1 477 2 is_stmt 1 view .LVU353
 1399              		.loc 1 477 11 is_stmt 0 view .LVU354
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 37


 1400 0010 254B     		ldr	r3, .L148
 1401              	.LVL143:
 1402              		.loc 1 477 11 view .LVU355
 1403 0012 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1404              		.loc 1 477 5 view .LVU356
 1405 0014 13F0010F 		tst	r3, #1
 1406 0018 41D1     		bne	.L138
 478:FATFS/Target/user_diskio_spi.c **** 		return RES_NOTRDY; /* Check drive status */
 479:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_PROTECT)
 1407              		.loc 1 479 2 is_stmt 1 view .LVU357
 1408              		.loc 1 479 11 is_stmt 0 view .LVU358
 1409 001a 234B     		ldr	r3, .L148
 1410 001c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1411              		.loc 1 479 5 view .LVU359
 1412 001e 13F0040F 		tst	r3, #4
 1413 0022 3ED1     		bne	.L139
 480:FATFS/Target/user_diskio_spi.c **** 		return RES_WRPRT; /* Check write protect */
 481:FATFS/Target/user_diskio_spi.c **** 
 482:FATFS/Target/user_diskio_spi.c **** 	if (!(CardType & CT_BLOCK))
 1414              		.loc 1 482 2 is_stmt 1 view .LVU360
 1415              		.loc 1 482 17 is_stmt 0 view .LVU361
 1416 0024 214B     		ldr	r3, .L148+4
 1417 0026 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1418              		.loc 1 482 5 view .LVU362
 1419 0028 13F0080F 		tst	r3, #8
 1420 002c 00D1     		bne	.L130
 483:FATFS/Target/user_diskio_spi.c **** 		sector *= 512; /* LBA ==> BA conversion (byte addressing cards) */
 1421              		.loc 1 483 3 is_stmt 1 view .LVU363
 1422              		.loc 1 483 10 is_stmt 0 view .LVU364
 1423 002e 5602     		lsls	r6, r2, #9
 1424              	.LVL144:
 1425              	.L130:
 484:FATFS/Target/user_diskio_spi.c **** 
 485:FATFS/Target/user_diskio_spi.c **** 	if (count == 1)
 1426              		.loc 1 485 2 is_stmt 1 view .LVU365
 1427              		.loc 1 485 5 is_stmt 0 view .LVU366
 1428 0030 012C     		cmp	r4, #1
 1429 0032 1BD0     		beq	.L146
 486:FATFS/Target/user_diskio_spi.c **** 	{									   /* Single sector write */
 487:FATFS/Target/user_diskio_spi.c **** 		if ((send_cmd(CMD24, sector) == 0) /* WRITE_BLOCK */
 488:FATFS/Target/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE))
 489:FATFS/Target/user_diskio_spi.c **** 		{
 490:FATFS/Target/user_diskio_spi.c **** 			count = 0;
 491:FATFS/Target/user_diskio_spi.c **** 		}
 492:FATFS/Target/user_diskio_spi.c **** 	}
 493:FATFS/Target/user_diskio_spi.c **** 	else
 494:FATFS/Target/user_diskio_spi.c **** 	{ /* Multiple sector write */
 495:FATFS/Target/user_diskio_spi.c **** 		if (CardType & CT_SDC)
 1430              		.loc 1 495 3 is_stmt 1 view .LVU367
 1431              		.loc 1 495 6 is_stmt 0 view .LVU368
 1432 0034 13F0060F 		tst	r3, #6
 1433 0038 26D1     		bne	.L147
 1434              	.LVL145:
 1435              	.L133:
 496:FATFS/Target/user_diskio_spi.c **** 			send_cmd(ACMD23, count); /* Predefine number of sectors */
 497:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0)
 1436              		.loc 1 497 3 is_stmt 1 view .LVU369
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 38


 1437              		.loc 1 497 7 is_stmt 0 view .LVU370
 1438 003a 3146     		mov	r1, r6
 1439 003c 1920     		movs	r0, #25
 1440 003e FFF7FEFF 		bl	send_cmd
 1441              	.LVL146:
 1442              		.loc 1 497 6 view .LVU371
 1443 0042 68B9     		cbnz	r0, .L132
 1444              	.L135:
 498:FATFS/Target/user_diskio_spi.c **** 		{ /* WRITE_MULTIPLE_BLOCK */
 499:FATFS/Target/user_diskio_spi.c **** 			do
 1445              		.loc 1 499 4 is_stmt 1 view .LVU372
 500:FATFS/Target/user_diskio_spi.c **** 			{
 501:FATFS/Target/user_diskio_spi.c **** 				if (!xmit_datablock(buff, 0xFC))
 1446              		.loc 1 501 5 view .LVU373
 1447              		.loc 1 501 10 is_stmt 0 view .LVU374
 1448 0044 FC21     		movs	r1, #252
 1449 0046 2846     		mov	r0, r5
 1450 0048 FFF7FEFF 		bl	xmit_datablock
 1451              	.LVL147:
 1452              		.loc 1 501 8 view .LVU375
 1453 004c 18B1     		cbz	r0, .L134
 502:FATFS/Target/user_diskio_spi.c **** 					break;
 503:FATFS/Target/user_diskio_spi.c **** 				buff += 512;
 1454              		.loc 1 503 5 is_stmt 1 view .LVU376
 1455              		.loc 1 503 10 is_stmt 0 view .LVU377
 1456 004e 05F50075 		add	r5, r5, #512
 1457              	.LVL148:
 504:FATFS/Target/user_diskio_spi.c **** 			} while (--count);
 1458              		.loc 1 504 12 is_stmt 1 view .LVU378
 1459              		.loc 1 504 4 is_stmt 0 view .LVU379
 1460 0052 013C     		subs	r4, r4, #1
 1461              	.LVL149:
 1462              		.loc 1 504 4 view .LVU380
 1463 0054 F6D1     		bne	.L135
 1464              	.L134:
 505:FATFS/Target/user_diskio_spi.c **** 			if (!xmit_datablock(0, 0xFD))
 1465              		.loc 1 505 4 is_stmt 1 view .LVU381
 1466              		.loc 1 505 9 is_stmt 0 view .LVU382
 1467 0056 FD21     		movs	r1, #253
 1468 0058 0020     		movs	r0, #0
 1469 005a FFF7FEFF 		bl	xmit_datablock
 1470              	.LVL150:
 1471              		.loc 1 505 7 view .LVU383
 1472 005e C0B1     		cbz	r0, .L141
 1473              	.LVL151:
 1474              	.L132:
 506:FATFS/Target/user_diskio_spi.c **** 				count = 1; /* STOP_TRAN token */
 507:FATFS/Target/user_diskio_spi.c **** 		}
 508:FATFS/Target/user_diskio_spi.c **** 	}
 509:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 1475              		.loc 1 509 2 is_stmt 1 view .LVU384
 1476 0060 FFF7FEFF 		bl	despiselect
 1477              	.LVL152:
 510:FATFS/Target/user_diskio_spi.c **** 
 511:FATFS/Target/user_diskio_spi.c **** 	return count ? RES_ERROR : RES_OK; /* Return result */
 1478              		.loc 1 511 2 view .LVU385
 1479              		.loc 1 511 27 is_stmt 0 view .LVU386
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 39


 1480 0064 201E     		subs	r0, r4, #0
 1481 0066 18BF     		it	ne
 1482 0068 0120     		movne	r0, #1
 1483              	.L129:
 512:FATFS/Target/user_diskio_spi.c **** }
 1484              		.loc 1 512 1 view .LVU387
 1485 006a 70BD     		pop	{r4, r5, r6, pc}
 1486              	.LVL153:
 1487              	.L146:
 487:FATFS/Target/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE))
 1488              		.loc 1 487 3 is_stmt 1 view .LVU388
 487:FATFS/Target/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE))
 1489              		.loc 1 487 8 is_stmt 0 view .LVU389
 1490 006c 3146     		mov	r1, r6
 1491              	.LVL154:
 487:FATFS/Target/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE))
 1492              		.loc 1 487 8 view .LVU390
 1493 006e 1820     		movs	r0, #24
 1494              	.LVL155:
 487:FATFS/Target/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE))
 1495              		.loc 1 487 8 view .LVU391
 1496 0070 FFF7FEFF 		bl	send_cmd
 1497              	.LVL156:
 487:FATFS/Target/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE))
 1498              		.loc 1 487 6 view .LVU392
 1499 0074 0028     		cmp	r0, #0
 1500 0076 F3D1     		bne	.L132
 488:FATFS/Target/user_diskio_spi.c **** 		{
 1501              		.loc 1 488 7 view .LVU393
 1502 0078 FE21     		movs	r1, #254
 1503 007a 2846     		mov	r0, r5
 1504 007c FFF7FEFF 		bl	xmit_datablock
 1505              	.LVL157:
 488:FATFS/Target/user_diskio_spi.c **** 		{
 1506              		.loc 1 488 4 view .LVU394
 1507 0080 0028     		cmp	r0, #0
 1508 0082 EDD0     		beq	.L132
 490:FATFS/Target/user_diskio_spi.c **** 		}
 1509              		.loc 1 490 10 view .LVU395
 1510 0084 0024     		movs	r4, #0
 1511              	.LVL158:
 490:FATFS/Target/user_diskio_spi.c **** 		}
 1512              		.loc 1 490 10 view .LVU396
 1513 0086 EBE7     		b	.L132
 1514              	.LVL159:
 1515              	.L147:
 496:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0)
 1516              		.loc 1 496 4 is_stmt 1 view .LVU397
 1517 0088 2146     		mov	r1, r4
 1518              	.LVL160:
 496:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0)
 1519              		.loc 1 496 4 is_stmt 0 view .LVU398
 1520 008a 9720     		movs	r0, #151
 1521              	.LVL161:
 496:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0)
 1522              		.loc 1 496 4 view .LVU399
 1523 008c FFF7FEFF 		bl	send_cmd
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 40


 1524              	.LVL162:
 1525 0090 D3E7     		b	.L133
 1526              	.L141:
 506:FATFS/Target/user_diskio_spi.c **** 		}
 1527              		.loc 1 506 11 view .LVU400
 1528 0092 0124     		movs	r4, #1
 1529              	.LVL163:
 506:FATFS/Target/user_diskio_spi.c **** 		}
 1530              		.loc 1 506 11 view .LVU401
 1531 0094 E4E7     		b	.L132
 1532              	.LVL164:
 1533              	.L136:
 1534              	.LCFI24:
 1535              		.cfi_def_cfa_offset 0
 1536              		.cfi_restore 4
 1537              		.cfi_restore 5
 1538              		.cfi_restore 6
 1539              		.cfi_restore 14
 476:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1540              		.loc 1 476 10 view .LVU402
 1541 0096 0420     		movs	r0, #4
 1542              	.LVL165:
 1543              		.loc 1 512 1 view .LVU403
 1544 0098 7047     		bx	lr
 1545              	.LVL166:
 1546              	.L137:
 1547              	.LCFI25:
 1548              		.cfi_def_cfa_offset 16
 1549              		.cfi_offset 4, -16
 1550              		.cfi_offset 5, -12
 1551              		.cfi_offset 6, -8
 1552              		.cfi_offset 14, -4
 476:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1553              		.loc 1 476 10 view .LVU404
 1554 009a 0420     		movs	r0, #4
 1555              	.LVL167:
 476:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1556              		.loc 1 476 10 view .LVU405
 1557 009c E5E7     		b	.L129
 1558              	.LVL168:
 1559              	.L138:
 478:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_PROTECT)
 1560              		.loc 1 478 10 view .LVU406
 1561 009e 0320     		movs	r0, #3
 1562              	.LVL169:
 478:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_PROTECT)
 1563              		.loc 1 478 10 view .LVU407
 1564 00a0 E3E7     		b	.L129
 1565              	.LVL170:
 1566              	.L139:
 480:FATFS/Target/user_diskio_spi.c **** 
 1567              		.loc 1 480 10 view .LVU408
 1568 00a2 0220     		movs	r0, #2
 1569              	.LVL171:
 480:FATFS/Target/user_diskio_spi.c **** 
 1570              		.loc 1 480 10 view .LVU409
 1571 00a4 E1E7     		b	.L129
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 41


 1572              	.L149:
 1573 00a6 00BF     		.align	2
 1574              	.L148:
 1575 00a8 00000000 		.word	.LANCHOR5
 1576 00ac 00000000 		.word	.LANCHOR6
 1577              		.cfi_endproc
 1578              	.LFE146:
 1580              		.section	.text.USER_SPI_ioctl,"ax",%progbits
 1581              		.align	1
 1582              		.global	USER_SPI_ioctl
 1583              		.syntax unified
 1584              		.thumb
 1585              		.thumb_func
 1586              		.fpu fpv4-sp-d16
 1588              	USER_SPI_ioctl:
 1589              	.LVL172:
 1590              	.LFB147:
 513:FATFS/Target/user_diskio_spi.c **** #endif
 514:FATFS/Target/user_diskio_spi.c **** 
 515:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 516:FATFS/Target/user_diskio_spi.c **** /* Miscellaneous drive controls other than data read/write               */
 517:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 518:FATFS/Target/user_diskio_spi.c **** 
 519:FATFS/Target/user_diskio_spi.c **** #if _USE_IOCTL
 520:FATFS/Target/user_diskio_spi.c **** inline DRESULT USER_SPI_ioctl(
 521:FATFS/Target/user_diskio_spi.c **** 	BYTE drv,  /* Physical drive number (0) */
 522:FATFS/Target/user_diskio_spi.c **** 	BYTE cmd,  /* Control command code */
 523:FATFS/Target/user_diskio_spi.c **** 	void *buff /* Pointer to the conrtol data */
 524:FATFS/Target/user_diskio_spi.c **** )
 525:FATFS/Target/user_diskio_spi.c **** {
 1591              		.loc 1 525 1 is_stmt 1 view -0
 1592              		.cfi_startproc
 1593              		@ args = 0, pretend = 0, frame = 16
 1594              		@ frame_needed = 0, uses_anonymous_args = 0
 1595              		.loc 1 525 1 is_stmt 0 view .LVU411
 1596 0000 70B5     		push	{r4, r5, r6, lr}
 1597              	.LCFI26:
 1598              		.cfi_def_cfa_offset 16
 1599              		.cfi_offset 4, -16
 1600              		.cfi_offset 5, -12
 1601              		.cfi_offset 6, -8
 1602              		.cfi_offset 14, -4
 1603 0002 84B0     		sub	sp, sp, #16
 1604              	.LCFI27:
 1605              		.cfi_def_cfa_offset 32
 526:FATFS/Target/user_diskio_spi.c **** 	DRESULT res;
 1606              		.loc 1 526 2 is_stmt 1 view .LVU412
 527:FATFS/Target/user_diskio_spi.c **** 	BYTE n, csd[16];
 1607              		.loc 1 527 2 view .LVU413
 528:FATFS/Target/user_diskio_spi.c **** 	DWORD *dp, st, ed, csize;
 1608              		.loc 1 528 2 view .LVU414
 529:FATFS/Target/user_diskio_spi.c **** 
 530:FATFS/Target/user_diskio_spi.c **** 	if (drv)
 1609              		.loc 1 530 2 view .LVU415
 1610              		.loc 1 530 5 is_stmt 0 view .LVU416
 1611 0004 0028     		cmp	r0, #0
 1612 0006 40F00481 		bne	.L165
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 42


 1613 000a 0D46     		mov	r5, r1
 1614 000c 1646     		mov	r6, r2
 531:FATFS/Target/user_diskio_spi.c **** 		return RES_PARERR; /* Check parameter */
 532:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 1615              		.loc 1 532 2 is_stmt 1 view .LVU417
 1616              		.loc 1 532 11 is_stmt 0 view .LVU418
 1617 000e 834B     		ldr	r3, .L190
 1618 0010 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1619              		.loc 1 532 5 view .LVU419
 1620 0012 13F0010F 		tst	r3, #1
 1621 0016 40F0FE80 		bne	.L166
 533:FATFS/Target/user_diskio_spi.c **** 		return RES_NOTRDY; /* Check if drive is ready */
 534:FATFS/Target/user_diskio_spi.c **** 
 535:FATFS/Target/user_diskio_spi.c **** 	res = RES_ERROR;
 1622              		.loc 1 535 2 is_stmt 1 view .LVU420
 1623              	.LVL173:
 536:FATFS/Target/user_diskio_spi.c **** 
 537:FATFS/Target/user_diskio_spi.c **** 	switch (cmd)
 1624              		.loc 1 537 2 view .LVU421
 1625 001a 0429     		cmp	r1, #4
 1626 001c 00F2ED80 		bhi	.L167
 1627 0020 DFE811F0 		tbh	[pc, r1, lsl #1]
 1628              	.L154:
 1629 0024 0500     		.2byte	(.L157-.L154)/2
 1630 0026 0C00     		.2byte	(.L156-.L154)/2
 1631 0028 EB00     		.2byte	(.L167-.L154)/2
 1632 002a 5400     		.2byte	(.L155-.L154)/2
 1633 002c AF00     		.2byte	(.L153-.L154)/2
 1634              		.p2align 1
 1635              	.L157:
 538:FATFS/Target/user_diskio_spi.c **** 	{
 539:FATFS/Target/user_diskio_spi.c **** 	case CTRL_SYNC: /* Wait for end of internal write process of the drive */
 540:FATFS/Target/user_diskio_spi.c **** 		if (spiselect())
 1636              		.loc 1 540 3 view .LVU422
 1637              		.loc 1 540 7 is_stmt 0 view .LVU423
 1638 002e FFF7FEFF 		bl	spiselect
 1639              	.LVL174:
 1640              		.loc 1 540 6 view .LVU424
 1641 0032 0028     		cmp	r0, #0
 1642 0034 40F0E380 		bne	.L168
 535:FATFS/Target/user_diskio_spi.c **** 
 1643              		.loc 1 535 6 view .LVU425
 1644 0038 0124     		movs	r4, #1
 1645 003a 06E0     		b	.L152
 1646              	.LVL175:
 1647              	.L156:
 541:FATFS/Target/user_diskio_spi.c **** 			res = RES_OK;
 542:FATFS/Target/user_diskio_spi.c **** 		break;
 543:FATFS/Target/user_diskio_spi.c **** 
 544:FATFS/Target/user_diskio_spi.c **** 	case GET_SECTOR_COUNT: /* Get drive capacity in unit of sector (DWORD) */
 545:FATFS/Target/user_diskio_spi.c **** 		if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16))
 1648              		.loc 1 545 3 is_stmt 1 view .LVU426
 1649              		.loc 1 545 8 is_stmt 0 view .LVU427
 1650 003c 0021     		movs	r1, #0
 1651              	.LVL176:
 1652              		.loc 1 545 8 view .LVU428
 1653 003e 0920     		movs	r0, #9
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 43


 1654              	.LVL177:
 1655              		.loc 1 545 8 view .LVU429
 1656 0040 FFF7FEFF 		bl	send_cmd
 1657              	.LVL178:
 1658              		.loc 1 545 6 view .LVU430
 1659 0044 0446     		mov	r4, r0
 1660 0046 28B1     		cbz	r0, .L182
 535:FATFS/Target/user_diskio_spi.c **** 
 1661              		.loc 1 535 6 view .LVU431
 1662 0048 2C46     		mov	r4, r5
 1663              	.LVL179:
 1664              	.L152:
 546:FATFS/Target/user_diskio_spi.c **** 		{
 547:FATFS/Target/user_diskio_spi.c **** 			if ((csd[0] >> 6) == 1)
 548:FATFS/Target/user_diskio_spi.c **** 			{ /* SDC ver 2.00 */
 549:FATFS/Target/user_diskio_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 550:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 551:FATFS/Target/user_diskio_spi.c **** 			}
 552:FATFS/Target/user_diskio_spi.c **** 			else
 553:FATFS/Target/user_diskio_spi.c **** 			{ /* SDC ver 1.XX or MMC ver 3 */
 554:FATFS/Target/user_diskio_spi.c **** 				n = (csd[5] & 15) + ((csd[10] & 128) >> 7) + ((csd[9] & 3) << 1) + 2;
 555:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 556:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 557:FATFS/Target/user_diskio_spi.c **** 			}
 558:FATFS/Target/user_diskio_spi.c **** 			res = RES_OK;
 559:FATFS/Target/user_diskio_spi.c **** 		}
 560:FATFS/Target/user_diskio_spi.c **** 		break;
 561:FATFS/Target/user_diskio_spi.c **** 
 562:FATFS/Target/user_diskio_spi.c **** 	case GET_BLOCK_SIZE: /* Get erase block size in unit of sector (DWORD) */
 563:FATFS/Target/user_diskio_spi.c **** 		if (CardType & CT_SD2)
 564:FATFS/Target/user_diskio_spi.c **** 		{ /* SDC ver 2.00 */
 565:FATFS/Target/user_diskio_spi.c **** 			if (send_cmd(ACMD13, 0) == 0)
 566:FATFS/Target/user_diskio_spi.c **** 			{ /* Read SD status */
 567:FATFS/Target/user_diskio_spi.c **** 				xchg_spi(0xFF);
 568:FATFS/Target/user_diskio_spi.c **** 				if (rcvr_datablock(csd, 16))
 569:FATFS/Target/user_diskio_spi.c **** 				{ /* Read partial block */
 570:FATFS/Target/user_diskio_spi.c **** 					for (n = 64 - 16; n; n--)
 571:FATFS/Target/user_diskio_spi.c **** 						xchg_spi(0xFF); /* Purge trailing data */
 572:FATFS/Target/user_diskio_spi.c **** 					*(DWORD *)buff = 16UL << (csd[10] >> 4);
 573:FATFS/Target/user_diskio_spi.c **** 					res = RES_OK;
 574:FATFS/Target/user_diskio_spi.c **** 				}
 575:FATFS/Target/user_diskio_spi.c **** 			}
 576:FATFS/Target/user_diskio_spi.c **** 		}
 577:FATFS/Target/user_diskio_spi.c **** 		else
 578:FATFS/Target/user_diskio_spi.c **** 		{ /* SDC ver 1.XX or MMC */
 579:FATFS/Target/user_diskio_spi.c **** 			if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16))
 580:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 581:FATFS/Target/user_diskio_spi.c **** 				if (CardType & CT_SD1)
 582:FATFS/Target/user_diskio_spi.c **** 				{ /* SDC ver 1.XX */
 583:FATFS/Target/user_diskio_spi.c **** 					*(DWORD *)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6)
 584:FATFS/Target/user_diskio_spi.c **** 				}
 585:FATFS/Target/user_diskio_spi.c **** 				else
 586:FATFS/Target/user_diskio_spi.c **** 				{ /* MMC */
 587:FATFS/Target/user_diskio_spi.c **** 					*(DWORD *)buff = ((WORD)((csd[10] & 124) >> 2) + 1) * (((csd[11] & 3) << 3) + ((csd[11] & 224)
 588:FATFS/Target/user_diskio_spi.c **** 				}
 589:FATFS/Target/user_diskio_spi.c **** 				res = RES_OK;
 590:FATFS/Target/user_diskio_spi.c **** 			}
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 44


 591:FATFS/Target/user_diskio_spi.c **** 		}
 592:FATFS/Target/user_diskio_spi.c **** 		break;
 593:FATFS/Target/user_diskio_spi.c **** 
 594:FATFS/Target/user_diskio_spi.c **** 	case CTRL_TRIM: /* Erase a block of sectors (used when _USE_ERASE == 1) */
 595:FATFS/Target/user_diskio_spi.c **** 		if (!(CardType & CT_SDC))
 596:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if the card is SDC */
 597:FATFS/Target/user_diskio_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd))
 598:FATFS/Target/user_diskio_spi.c **** 			break; /* Get CSD */
 599:FATFS/Target/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40))
 600:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if sector erase can be applied to the card */
 601:FATFS/Target/user_diskio_spi.c **** 		dp = buff;
 602:FATFS/Target/user_diskio_spi.c **** 		st = dp[0];
 603:FATFS/Target/user_diskio_spi.c **** 		ed = dp[1]; /* Load sector block */
 604:FATFS/Target/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK))
 605:FATFS/Target/user_diskio_spi.c **** 		{
 606:FATFS/Target/user_diskio_spi.c **** 			st *= 512;
 607:FATFS/Target/user_diskio_spi.c **** 			ed *= 512;
 608:FATFS/Target/user_diskio_spi.c **** 		}
 609:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD32, st) == 0 && send_cmd(CMD33, ed) == 0 && send_cmd(CMD38, 0) == 0 && wait_ready
 610:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 611:FATFS/Target/user_diskio_spi.c **** 			res = RES_OK; /* FatFs does not check result of this command */
 612:FATFS/Target/user_diskio_spi.c **** 		}
 613:FATFS/Target/user_diskio_spi.c **** 		break;
 614:FATFS/Target/user_diskio_spi.c **** 
 615:FATFS/Target/user_diskio_spi.c **** 	default:
 616:FATFS/Target/user_diskio_spi.c **** 		res = RES_PARERR;
 617:FATFS/Target/user_diskio_spi.c **** 	}
 618:FATFS/Target/user_diskio_spi.c **** 
 619:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 1665              		.loc 1 619 2 is_stmt 1 view .LVU432
 1666 004a FFF7FEFF 		bl	despiselect
 1667              	.LVL180:
 620:FATFS/Target/user_diskio_spi.c **** 
 621:FATFS/Target/user_diskio_spi.c **** 	return res;
 1668              		.loc 1 621 2 view .LVU433
 1669              	.L151:
 622:FATFS/Target/user_diskio_spi.c **** }
 1670              		.loc 1 622 1 is_stmt 0 view .LVU434
 1671 004e 2046     		mov	r0, r4
 1672 0050 04B0     		add	sp, sp, #16
 1673              	.LCFI28:
 1674              		.cfi_remember_state
 1675              		.cfi_def_cfa_offset 16
 1676              		@ sp needed
 1677 0052 70BD     		pop	{r4, r5, r6, pc}
 1678              	.LVL181:
 1679              	.L182:
 1680              	.LCFI29:
 1681              		.cfi_restore_state
 545:FATFS/Target/user_diskio_spi.c **** 		{
 1682              		.loc 1 545 35 discriminator 1 view .LVU435
 1683 0054 1021     		movs	r1, #16
 1684 0056 6846     		mov	r0, sp
 1685 0058 FFF7FEFF 		bl	rcvr_datablock
 1686              	.LVL182:
 545:FATFS/Target/user_diskio_spi.c **** 		{
 1687              		.loc 1 545 32 discriminator 1 view .LVU436
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 45


 1688 005c 0028     		cmp	r0, #0
 1689 005e 00F0D080 		beq	.L170
 547:FATFS/Target/user_diskio_spi.c **** 			{ /* SDC ver 2.00 */
 1690              		.loc 1 547 4 is_stmt 1 view .LVU437
 547:FATFS/Target/user_diskio_spi.c **** 			{ /* SDC ver 2.00 */
 1691              		.loc 1 547 12 is_stmt 0 view .LVU438
 1692 0062 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 547:FATFS/Target/user_diskio_spi.c **** 			{ /* SDC ver 2.00 */
 1693              		.loc 1 547 22 view .LVU439
 1694 0066 9B09     		lsrs	r3, r3, #6
 547:FATFS/Target/user_diskio_spi.c **** 			{ /* SDC ver 2.00 */
 1695              		.loc 1 547 7 view .LVU440
 1696 0068 012B     		cmp	r3, #1
 1697 006a 1FD0     		beq	.L183
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1698              		.loc 1 554 5 is_stmt 1 view .LVU441
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1699              		.loc 1 554 13 is_stmt 0 view .LVU442
 1700 006c 9DF80520 		ldrb	r2, [sp, #5]	@ zero_extendqisi2
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1701              		.loc 1 554 17 view .LVU443
 1702 0070 02F00F02 		and	r2, r2, #15
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1703              		.loc 1 554 30 view .LVU444
 1704 0074 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1705              		.loc 1 554 23 view .LVU445
 1706 0078 02EBD312 		add	r2, r2, r3, lsr #7
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1707              		.loc 1 554 55 view .LVU446
 1708 007c 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1709              		.loc 1 554 64 view .LVU447
 1710 0080 5B00     		lsls	r3, r3, #1
 1711 0082 03F00603 		and	r3, r3, #6
 554:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1712              		.loc 1 554 48 view .LVU448
 1713 0086 1A44     		add	r2, r2, r3
 1714              	.LVL183:
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1715              		.loc 1 555 5 is_stmt 1 view .LVU449
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1716              		.loc 1 555 17 is_stmt 0 view .LVU450
 1717 0088 9DF80810 		ldrb	r1, [sp, #8]	@ zero_extendqisi2
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1718              		.loc 1 555 39 view .LVU451
 1719 008c 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1720              		.loc 1 555 43 view .LVU452
 1721 0090 9B00     		lsls	r3, r3, #2
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1722              		.loc 1 555 27 view .LVU453
 1723 0092 03EB9113 		add	r3, r3, r1, lsr #6
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1724              		.loc 1 555 62 view .LVU454
 1725 0096 9DF80610 		ldrb	r1, [sp, #6]	@ zero_extendqisi2
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 46


 1726              		.loc 1 555 71 view .LVU455
 1727 009a 8902     		lsls	r1, r1, #10
 1728 009c 01F44061 		and	r1, r1, #3072
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1729              		.loc 1 555 49 view .LVU456
 1730 00a0 0B44     		add	r3, r3, r1
 555:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << (n - 9);
 1731              		.loc 1 555 78 view .LVU457
 1732 00a2 0133     		adds	r3, r3, #1
 1733              	.LVL184:
 556:FATFS/Target/user_diskio_spi.c **** 			}
 1734              		.loc 1 556 5 is_stmt 1 view .LVU458
 556:FATFS/Target/user_diskio_spi.c **** 			}
 1735              		.loc 1 556 34 is_stmt 0 view .LVU459
 1736 00a4 073A     		subs	r2, r2, #7
 1737              	.LVL185:
 556:FATFS/Target/user_diskio_spi.c **** 			}
 1738              		.loc 1 556 28 view .LVU460
 1739 00a6 9340     		lsls	r3, r3, r2
 1740              	.LVL186:
 556:FATFS/Target/user_diskio_spi.c **** 			}
 1741              		.loc 1 556 20 view .LVU461
 1742 00a8 3360     		str	r3, [r6]
 1743              	.LVL187:
 556:FATFS/Target/user_diskio_spi.c **** 			}
 1744              		.loc 1 556 20 view .LVU462
 1745 00aa CEE7     		b	.L152
 1746              	.LVL188:
 1747              	.L183:
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1748              		.loc 1 549 5 is_stmt 1 view .LVU463
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1749              		.loc 1 549 16 is_stmt 0 view .LVU464
 1750 00ac 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1751              		.loc 1 549 32 view .LVU465
 1752 00b0 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1753              		.loc 1 549 20 view .LVU466
 1754 00b4 03EB0223 		add	r3, r3, r2, lsl #8
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1755              		.loc 1 549 56 view .LVU467
 1756 00b8 9DF80720 		ldrb	r2, [sp, #7]	@ zero_extendqisi2
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1757              		.loc 1 549 66 view .LVU468
 1758 00bc 1204     		lsls	r2, r2, #16
 1759 00be 02F47C12 		and	r2, r2, #4128768
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1760              		.loc 1 549 42 view .LVU469
 1761 00c2 1344     		add	r3, r3, r2
 549:FATFS/Target/user_diskio_spi.c **** 				*(DWORD *)buff = csize << 10;
 1762              		.loc 1 549 11 view .LVU470
 1763 00c4 0133     		adds	r3, r3, #1
 1764              	.LVL189:
 550:FATFS/Target/user_diskio_spi.c **** 			}
 1765              		.loc 1 550 5 is_stmt 1 view .LVU471
 550:FATFS/Target/user_diskio_spi.c **** 			}
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 47


 1766              		.loc 1 550 28 is_stmt 0 view .LVU472
 1767 00c6 9B02     		lsls	r3, r3, #10
 1768              	.LVL190:
 550:FATFS/Target/user_diskio_spi.c **** 			}
 1769              		.loc 1 550 20 view .LVU473
 1770 00c8 3360     		str	r3, [r6]
 1771              	.LVL191:
 550:FATFS/Target/user_diskio_spi.c **** 			}
 1772              		.loc 1 550 20 view .LVU474
 1773 00ca BEE7     		b	.L152
 1774              	.LVL192:
 1775              	.L155:
 563:FATFS/Target/user_diskio_spi.c **** 		{ /* SDC ver 2.00 */
 1776              		.loc 1 563 3 is_stmt 1 view .LVU475
 563:FATFS/Target/user_diskio_spi.c **** 		{ /* SDC ver 2.00 */
 1777              		.loc 1 563 16 is_stmt 0 view .LVU476
 1778 00cc 544B     		ldr	r3, .L190+4
 1779 00ce 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 563:FATFS/Target/user_diskio_spi.c **** 		{ /* SDC ver 2.00 */
 1780              		.loc 1 563 6 view .LVU477
 1781 00d0 13F0040F 		tst	r3, #4
 1782 00d4 20D0     		beq	.L159
 565:FATFS/Target/user_diskio_spi.c **** 			{ /* Read SD status */
 1783              		.loc 1 565 4 is_stmt 1 view .LVU478
 565:FATFS/Target/user_diskio_spi.c **** 			{ /* Read SD status */
 1784              		.loc 1 565 8 is_stmt 0 view .LVU479
 1785 00d6 0021     		movs	r1, #0
 1786              	.LVL193:
 565:FATFS/Target/user_diskio_spi.c **** 			{ /* Read SD status */
 1787              		.loc 1 565 8 view .LVU480
 1788 00d8 8D20     		movs	r0, #141
 1789              	.LVL194:
 565:FATFS/Target/user_diskio_spi.c **** 			{ /* Read SD status */
 1790              		.loc 1 565 8 view .LVU481
 1791 00da FFF7FEFF 		bl	send_cmd
 1792              	.LVL195:
 565:FATFS/Target/user_diskio_spi.c **** 			{ /* Read SD status */
 1793              		.loc 1 565 7 view .LVU482
 1794 00de 08B1     		cbz	r0, .L184
 535:FATFS/Target/user_diskio_spi.c **** 
 1795              		.loc 1 535 6 view .LVU483
 1796 00e0 0124     		movs	r4, #1
 1797 00e2 B2E7     		b	.L152
 1798              	.L184:
 567:FATFS/Target/user_diskio_spi.c **** 				if (rcvr_datablock(csd, 16))
 1799              		.loc 1 567 5 is_stmt 1 view .LVU484
 1800 00e4 FF20     		movs	r0, #255
 1801 00e6 FFF7FEFF 		bl	xchg_spi
 1802              	.LVL196:
 568:FATFS/Target/user_diskio_spi.c **** 				{ /* Read partial block */
 1803              		.loc 1 568 5 view .LVU485
 568:FATFS/Target/user_diskio_spi.c **** 				{ /* Read partial block */
 1804              		.loc 1 568 9 is_stmt 0 view .LVU486
 1805 00ea 1021     		movs	r1, #16
 1806 00ec 6846     		mov	r0, sp
 1807 00ee FFF7FEFF 		bl	rcvr_datablock
 1808              	.LVL197:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 48


 568:FATFS/Target/user_diskio_spi.c **** 				{ /* Read partial block */
 1809              		.loc 1 568 8 view .LVU487
 1810 00f2 78B9     		cbnz	r0, .L172
 535:FATFS/Target/user_diskio_spi.c **** 
 1811              		.loc 1 535 6 view .LVU488
 1812 00f4 0124     		movs	r4, #1
 1813 00f6 A8E7     		b	.L152
 1814              	.LVL198:
 1815              	.L161:
 571:FATFS/Target/user_diskio_spi.c **** 					*(DWORD *)buff = 16UL << (csd[10] >> 4);
 1816              		.loc 1 571 7 is_stmt 1 discriminator 3 view .LVU489
 1817 00f8 FF20     		movs	r0, #255
 1818 00fa FFF7FEFF 		bl	xchg_spi
 1819              	.LVL199:
 570:FATFS/Target/user_diskio_spi.c **** 						xchg_spi(0xFF); /* Purge trailing data */
 1820              		.loc 1 570 27 discriminator 3 view .LVU490
 570:FATFS/Target/user_diskio_spi.c **** 						xchg_spi(0xFF); /* Purge trailing data */
 1821              		.loc 1 570 28 is_stmt 0 discriminator 3 view .LVU491
 1822 00fe 013C     		subs	r4, r4, #1
 1823              	.LVL200:
 570:FATFS/Target/user_diskio_spi.c **** 						xchg_spi(0xFF); /* Purge trailing data */
 1824              		.loc 1 570 28 discriminator 3 view .LVU492
 1825 0100 E4B2     		uxtb	r4, r4
 1826              	.LVL201:
 1827              	.L160:
 570:FATFS/Target/user_diskio_spi.c **** 						xchg_spi(0xFF); /* Purge trailing data */
 1828              		.loc 1 570 24 is_stmt 1 discriminator 1 view .LVU493
 570:FATFS/Target/user_diskio_spi.c **** 						xchg_spi(0xFF); /* Purge trailing data */
 1829              		.loc 1 570 6 is_stmt 0 discriminator 1 view .LVU494
 1830 0102 002C     		cmp	r4, #0
 1831 0104 F8D1     		bne	.L161
 572:FATFS/Target/user_diskio_spi.c **** 					res = RES_OK;
 1832              		.loc 1 572 6 is_stmt 1 view .LVU495
 572:FATFS/Target/user_diskio_spi.c **** 					res = RES_OK;
 1833              		.loc 1 572 35 is_stmt 0 view .LVU496
 1834 0106 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 572:FATFS/Target/user_diskio_spi.c **** 					res = RES_OK;
 1835              		.loc 1 572 40 view .LVU497
 1836 010a 1A09     		lsrs	r2, r3, #4
 572:FATFS/Target/user_diskio_spi.c **** 					res = RES_OK;
 1837              		.loc 1 572 28 view .LVU498
 1838 010c 1023     		movs	r3, #16
 1839 010e 9340     		lsls	r3, r3, r2
 572:FATFS/Target/user_diskio_spi.c **** 					res = RES_OK;
 1840              		.loc 1 572 21 view .LVU499
 1841 0110 3360     		str	r3, [r6]
 573:FATFS/Target/user_diskio_spi.c **** 				}
 1842              		.loc 1 573 6 is_stmt 1 view .LVU500
 1843              	.LVL202:
 573:FATFS/Target/user_diskio_spi.c **** 				}
 1844              		.loc 1 573 6 is_stmt 0 view .LVU501
 1845 0112 9AE7     		b	.L152
 1846              	.LVL203:
 1847              	.L172:
 570:FATFS/Target/user_diskio_spi.c **** 						xchg_spi(0xFF); /* Purge trailing data */
 1848              		.loc 1 570 13 view .LVU502
 1849 0114 3024     		movs	r4, #48
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 49


 1850 0116 F4E7     		b	.L160
 1851              	.LVL204:
 1852              	.L159:
 579:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 1853              		.loc 1 579 4 is_stmt 1 view .LVU503
 579:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 1854              		.loc 1 579 9 is_stmt 0 view .LVU504
 1855 0118 0021     		movs	r1, #0
 1856              	.LVL205:
 579:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 1857              		.loc 1 579 9 view .LVU505
 1858 011a 0920     		movs	r0, #9
 1859              	.LVL206:
 579:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 1860              		.loc 1 579 9 view .LVU506
 1861 011c FFF7FEFF 		bl	send_cmd
 1862              	.LVL207:
 579:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 1863              		.loc 1 579 7 view .LVU507
 1864 0120 0546     		mov	r5, r0
 1865 0122 08B1     		cbz	r0, .L185
 535:FATFS/Target/user_diskio_spi.c **** 
 1866              		.loc 1 535 6 view .LVU508
 1867 0124 0124     		movs	r4, #1
 1868 0126 90E7     		b	.L152
 1869              	.L185:
 579:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 1870              		.loc 1 579 36 discriminator 1 view .LVU509
 1871 0128 1021     		movs	r1, #16
 1872 012a 6846     		mov	r0, sp
 1873 012c FFF7FEFF 		bl	rcvr_datablock
 1874              	.LVL208:
 579:FATFS/Target/user_diskio_spi.c **** 			{ /* Read CSD */
 1875              		.loc 1 579 33 discriminator 1 view .LVU510
 1876 0130 0028     		cmp	r0, #0
 1877 0132 68D0     		beq	.L174
 581:FATFS/Target/user_diskio_spi.c **** 				{ /* SDC ver 1.XX */
 1878              		.loc 1 581 5 is_stmt 1 view .LVU511
 581:FATFS/Target/user_diskio_spi.c **** 				{ /* SDC ver 1.XX */
 1879              		.loc 1 581 18 is_stmt 0 view .LVU512
 1880 0134 3A4B     		ldr	r3, .L190+4
 1881 0136 1C78     		ldrb	r4, [r3]	@ zero_extendqisi2
 581:FATFS/Target/user_diskio_spi.c **** 				{ /* SDC ver 1.XX */
 1882              		.loc 1 581 8 view .LVU513
 1883 0138 14F00204 		ands	r4, r4, #2
 1884 013c 11D0     		beq	.L162
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1885              		.loc 1 583 6 is_stmt 1 view .LVU514
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1886              		.loc 1 583 29 is_stmt 0 view .LVU515
 1887 013e 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1888              		.loc 1 583 40 view .LVU516
 1889 0142 5B00     		lsls	r3, r3, #1
 1890 0144 03F07E03 		and	r3, r3, #126
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1891              		.loc 1 583 59 view .LVU517
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 50


 1892 0148 9DF80B20 		ldrb	r2, [sp, #11]	@ zero_extendqisi2
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1893              		.loc 1 583 46 view .LVU518
 1894 014c 03EBD213 		add	r3, r3, r2, lsr #7
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1895              		.loc 1 583 77 view .LVU519
 1896 0150 0133     		adds	r3, r3, #1
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1897              		.loc 1 583 90 view .LVU520
 1898 0152 9DF80D20 		ldrb	r2, [sp, #13]	@ zero_extendqisi2
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1899              		.loc 1 583 95 view .LVU521
 1900 0156 9209     		lsrs	r2, r2, #6
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1901              		.loc 1 583 101 view .LVU522
 1902 0158 013A     		subs	r2, r2, #1
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1903              		.loc 1 583 82 view .LVU523
 1904 015a 9340     		lsls	r3, r3, r2
 583:FATFS/Target/user_diskio_spi.c **** 				}
 1905              		.loc 1 583 21 view .LVU524
 1906 015c 3360     		str	r3, [r6]
 589:FATFS/Target/user_diskio_spi.c **** 			}
 1907              		.loc 1 589 9 view .LVU525
 1908 015e 2C46     		mov	r4, r5
 1909 0160 73E7     		b	.L152
 1910              	.L162:
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1911              		.loc 1 587 6 is_stmt 1 view .LVU526
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1912              		.loc 1 587 35 is_stmt 0 view .LVU527
 1913 0162 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1914              		.loc 1 587 24 view .LVU528
 1915 0166 C3F38402 		ubfx	r2, r3, #2, #5
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1916              		.loc 1 587 66 view .LVU529
 1917 016a 9DF80B10 		ldrb	r1, [sp, #11]	@ zero_extendqisi2
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1918              		.loc 1 587 76 view .LVU530
 1919 016e CB00     		lsls	r3, r1, #3
 1920 0170 03F01803 		and	r3, r3, #24
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1921              		.loc 1 587 82 view .LVU531
 1922 0174 03EB5113 		add	r3, r3, r1, lsr #5
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1923              		.loc 1 587 107 view .LVU532
 1924 0178 0133     		adds	r3, r3, #1
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1925              		.loc 1 587 58 view .LVU533
 1926 017a 02FB0333 		mla	r3, r2, r3, r3
 587:FATFS/Target/user_diskio_spi.c **** 				}
 1927              		.loc 1 587 21 view .LVU534
 1928 017e 3360     		str	r3, [r6]
 1929 0180 63E7     		b	.L152
 1930              	.LVL209:
 1931              	.L153:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 51


 595:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if the card is SDC */
 1932              		.loc 1 595 3 is_stmt 1 view .LVU535
 595:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if the card is SDC */
 1933              		.loc 1 595 18 is_stmt 0 view .LVU536
 1934 0182 274B     		ldr	r3, .L190+4
 1935 0184 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 595:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if the card is SDC */
 1936              		.loc 1 595 6 view .LVU537
 1937 0186 13F0060F 		tst	r3, #6
 1938 018a 01D1     		bne	.L186
 535:FATFS/Target/user_diskio_spi.c **** 
 1939              		.loc 1 535 6 view .LVU538
 1940 018c 0124     		movs	r4, #1
 1941 018e 5CE7     		b	.L152
 1942              	.L186:
 597:FATFS/Target/user_diskio_spi.c **** 			break; /* Get CSD */
 1943              		.loc 1 597 3 is_stmt 1 view .LVU539
 597:FATFS/Target/user_diskio_spi.c **** 			break; /* Get CSD */
 1944              		.loc 1 597 7 is_stmt 0 view .LVU540
 1945 0190 6A46     		mov	r2, sp
 1946              	.LVL210:
 597:FATFS/Target/user_diskio_spi.c **** 			break; /* Get CSD */
 1947              		.loc 1 597 7 view .LVU541
 1948 0192 0B21     		movs	r1, #11
 1949              	.LVL211:
 597:FATFS/Target/user_diskio_spi.c **** 			break; /* Get CSD */
 1950              		.loc 1 597 7 view .LVU542
 1951 0194 FFF7FEFF 		bl	USER_SPI_ioctl
 1952              	.LVL212:
 597:FATFS/Target/user_diskio_spi.c **** 			break; /* Get CSD */
 1953              		.loc 1 597 6 view .LVU543
 1954 0198 B8BB     		cbnz	r0, .L176
 599:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if sector erase can be applied to the card */
 1955              		.loc 1 599 3 is_stmt 1 view .LVU544
 599:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if sector erase can be applied to the card */
 1956              		.loc 1 599 12 is_stmt 0 view .LVU545
 1957 019a 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 599:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if sector erase can be applied to the card */
 1958              		.loc 1 599 6 view .LVU546
 1959 019e 9B09     		lsrs	r3, r3, #6
 1960 01a0 04D1     		bne	.L163
 599:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if sector erase can be applied to the card */
 1961              		.loc 1 599 30 discriminator 1 view .LVU547
 1962 01a2 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 599:FATFS/Target/user_diskio_spi.c **** 			break; /* Check if sector erase can be applied to the card */
 1963              		.loc 1 599 22 discriminator 1 view .LVU548
 1964 01a6 13F0400F 		tst	r3, #64
 1965 01aa 30D0     		beq	.L177
 1966              	.L163:
 601:FATFS/Target/user_diskio_spi.c **** 		st = dp[0];
 1967              		.loc 1 601 3 is_stmt 1 view .LVU549
 1968              	.LVL213:
 602:FATFS/Target/user_diskio_spi.c **** 		ed = dp[1]; /* Load sector block */
 1969              		.loc 1 602 3 view .LVU550
 602:FATFS/Target/user_diskio_spi.c **** 		ed = dp[1]; /* Load sector block */
 1970              		.loc 1 602 6 is_stmt 0 view .LVU551
 1971 01ac 3168     		ldr	r1, [r6]
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 52


 1972              	.LVL214:
 603:FATFS/Target/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK))
 1973              		.loc 1 603 3 is_stmt 1 view .LVU552
 603:FATFS/Target/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK))
 1974              		.loc 1 603 6 is_stmt 0 view .LVU553
 1975 01ae 7468     		ldr	r4, [r6, #4]
 1976              	.LVL215:
 604:FATFS/Target/user_diskio_spi.c **** 		{
 1977              		.loc 1 604 3 is_stmt 1 view .LVU554
 604:FATFS/Target/user_diskio_spi.c **** 		{
 1978              		.loc 1 604 18 is_stmt 0 view .LVU555
 1979 01b0 1B4B     		ldr	r3, .L190+4
 1980 01b2 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 604:FATFS/Target/user_diskio_spi.c **** 		{
 1981              		.loc 1 604 6 view .LVU556
 1982 01b4 13F0080F 		tst	r3, #8
 1983 01b8 01D1     		bne	.L164
 606:FATFS/Target/user_diskio_spi.c **** 			ed *= 512;
 1984              		.loc 1 606 4 is_stmt 1 view .LVU557
 606:FATFS/Target/user_diskio_spi.c **** 			ed *= 512;
 1985              		.loc 1 606 7 is_stmt 0 view .LVU558
 1986 01ba 4902     		lsls	r1, r1, #9
 1987              	.LVL216:
 607:FATFS/Target/user_diskio_spi.c **** 		}
 1988              		.loc 1 607 4 is_stmt 1 view .LVU559
 607:FATFS/Target/user_diskio_spi.c **** 		}
 1989              		.loc 1 607 7 is_stmt 0 view .LVU560
 1990 01bc 6402     		lsls	r4, r4, #9
 1991              	.LVL217:
 1992              	.L164:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 1993              		.loc 1 609 3 is_stmt 1 view .LVU561
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 1994              		.loc 1 609 7 is_stmt 0 view .LVU562
 1995 01be 2020     		movs	r0, #32
 1996 01c0 FFF7FEFF 		bl	send_cmd
 1997              	.LVL218:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 1998              		.loc 1 609 6 view .LVU563
 1999 01c4 08B1     		cbz	r0, .L187
 535:FATFS/Target/user_diskio_spi.c **** 
 2000              		.loc 1 535 6 view .LVU564
 2001 01c6 0124     		movs	r4, #1
 2002              	.LVL219:
 535:FATFS/Target/user_diskio_spi.c **** 
 2003              		.loc 1 535 6 view .LVU565
 2004 01c8 3FE7     		b	.L152
 2005              	.LVL220:
 2006              	.L187:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 2007              		.loc 1 609 35 discriminator 1 view .LVU566
 2008 01ca 2146     		mov	r1, r4
 2009 01cc 2120     		movs	r0, #33
 2010 01ce FFF7FEFF 		bl	send_cmd
 2011              	.LVL221:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 2012              		.loc 1 609 32 discriminator 1 view .LVU567
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 53


 2013 01d2 08B1     		cbz	r0, .L188
 535:FATFS/Target/user_diskio_spi.c **** 
 2014              		.loc 1 535 6 view .LVU568
 2015 01d4 0124     		movs	r4, #1
 2016              	.LVL222:
 535:FATFS/Target/user_diskio_spi.c **** 
 2017              		.loc 1 535 6 view .LVU569
 2018 01d6 38E7     		b	.L152
 2019              	.LVL223:
 2020              	.L188:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 2021              		.loc 1 609 63 discriminator 2 view .LVU570
 2022 01d8 0021     		movs	r1, #0
 2023 01da 2620     		movs	r0, #38
 2024 01dc FFF7FEFF 		bl	send_cmd
 2025              	.LVL224:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 2026              		.loc 1 609 60 discriminator 2 view .LVU571
 2027 01e0 0446     		mov	r4, r0
 2028              	.LVL225:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 2029              		.loc 1 609 60 discriminator 2 view .LVU572
 2030 01e2 08B1     		cbz	r0, .L189
 535:FATFS/Target/user_diskio_spi.c **** 
 2031              		.loc 1 535 6 view .LVU573
 2032 01e4 0124     		movs	r4, #1
 2033 01e6 30E7     		b	.L152
 2034              	.L189:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 2035              		.loc 1 609 90 discriminator 3 view .LVU574
 2036 01e8 47F23050 		movw	r0, #30000
 2037 01ec FFF7FEFF 		bl	wait_ready
 2038              	.LVL226:
 609:FATFS/Target/user_diskio_spi.c **** 		{				  /* Erase sector block */
 2039              		.loc 1 609 87 discriminator 3 view .LVU575
 2040 01f0 0028     		cmp	r0, #0
 2041 01f2 7FF42AAF 		bne	.L152
 535:FATFS/Target/user_diskio_spi.c **** 
 2042              		.loc 1 535 6 view .LVU576
 2043 01f6 0124     		movs	r4, #1
 2044 01f8 27E7     		b	.L152
 2045              	.LVL227:
 2046              	.L167:
 532:FATFS/Target/user_diskio_spi.c **** 		return RES_NOTRDY; /* Check if drive is ready */
 2047              		.loc 1 532 5 view .LVU577
 2048 01fa 0424     		movs	r4, #4
 2049 01fc 25E7     		b	.L152
 2050              	.LVL228:
 2051              	.L168:
 541:FATFS/Target/user_diskio_spi.c **** 		break;
 2052              		.loc 1 541 8 view .LVU578
 2053 01fe 2C46     		mov	r4, r5
 2054 0200 23E7     		b	.L152
 2055              	.L170:
 535:FATFS/Target/user_diskio_spi.c **** 
 2056              		.loc 1 535 6 view .LVU579
 2057 0202 2C46     		mov	r4, r5
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 54


 2058 0204 21E7     		b	.L152
 2059              	.L174:
 2060 0206 0124     		movs	r4, #1
 2061 0208 1FE7     		b	.L152
 2062              	.L176:
 2063 020a 0124     		movs	r4, #1
 2064 020c 1DE7     		b	.L152
 2065              	.L177:
 2066 020e 0124     		movs	r4, #1
 2067 0210 1BE7     		b	.L152
 2068              	.LVL229:
 2069              	.L165:
 531:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT)
 2070              		.loc 1 531 10 view .LVU580
 2071 0212 0424     		movs	r4, #4
 2072 0214 1BE7     		b	.L151
 2073              	.L166:
 533:FATFS/Target/user_diskio_spi.c **** 
 2074              		.loc 1 533 10 view .LVU581
 2075 0216 0324     		movs	r4, #3
 2076 0218 19E7     		b	.L151
 2077              	.L191:
 2078 021a 00BF     		.align	2
 2079              	.L190:
 2080 021c 00000000 		.word	.LANCHOR5
 2081 0220 00000000 		.word	.LANCHOR6
 2082              		.cfi_endproc
 2083              	.LFE147:
 2085              		.global	pivot
 2086              		.global	cmdBuffer
 2087              		.global	token
 2088              		.global	spiTimerTickDelay
 2089              		.global	spiTimerTickStart
 2090              		.section	.bss.CardType,"aw",%nobits
 2091              		.set	.LANCHOR6,. + 0
 2094              	CardType:
 2095 0000 00       		.space	1
 2096              		.section	.bss.cmdBuffer,"aw",%nobits
 2097              		.align	2
 2098              		.set	.LANCHOR1,. + 0
 2101              	cmdBuffer:
 2102 0000 00000000 		.space	400
 2102      00000000 
 2102      00000000 
 2102      00000000 
 2102      00000000 
 2103              		.section	.bss.pivot,"aw",%nobits
 2104              		.align	2
 2105              		.set	.LANCHOR0,. + 0
 2108              	pivot:
 2109 0000 00000000 		.space	4
 2110              		.section	.bss.spiTimerTickDelay,"aw",%nobits
 2111              		.align	2
 2112              		.set	.LANCHOR3,. + 0
 2115              	spiTimerTickDelay:
 2116 0000 00000000 		.space	4
 2117              		.section	.bss.spiTimerTickStart,"aw",%nobits
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 55


 2118              		.align	2
 2119              		.set	.LANCHOR2,. + 0
 2122              	spiTimerTickStart:
 2123 0000 00000000 		.space	4
 2124              		.section	.bss.token,"aw",%nobits
 2125              		.set	.LANCHOR4,. + 0
 2128              	token:
 2129 0000 00       		.space	1
 2130              		.section	.data.Stat,"aw"
 2131              		.set	.LANCHOR5,. + 0
 2134              	Stat:
 2135 0000 01       		.byte	1
 2136              		.text
 2137              	.Letext0:
 2138              		.file 2 "d:\\msys64\\mingw64\\arm-none-eabi\\include\\machine\\_default_types.h"
 2139              		.file 3 "d:\\msys64\\mingw64\\arm-none-eabi\\include\\sys\\_stdint.h"
 2140              		.file 4 "Drivers/CMSIS/Device/ST/STM32G4xx/Include/stm32g431xx.h"
 2141              		.file 5 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_def.h"
 2142              		.file 6 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_gpio.h"
 2143              		.file 7 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_dma.h"
 2144              		.file 8 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_spi.h"
 2145              		.file 9 "Middlewares/Third_Party/FatFs/src/integer.h"
 2146              		.file 10 "Middlewares/Third_Party/FatFs/src/diskio.h"
 2147              		.file 11 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal.h"
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 56


DEFINED SYMBOLS
                            *ABS*:0000000000000000 user_diskio_spi.c
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:18     .text.xchg_spi:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:25     .text.xchg_spi:0000000000000000 xchg_spi
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:65     .text.xchg_spi:0000000000000028 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:70     .text.wait_ready:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:76     .text.wait_ready:0000000000000000 wait_ready
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:137    .text.rcvr_spi_multi:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:143    .text.rcvr_spi_multi:0000000000000000 rcvr_spi_multi
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:194    .text.xmit_spi_multi:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:200    .text.xmit_spi_multi:0000000000000000 xmit_spi_multi
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:248    .text.xmit_datablock:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:254    .text.xmit_datablock:0000000000000000 xmit_datablock
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:334    .text.despiselect:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:340    .text.despiselect:0000000000000000 despiselect
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:367    .text.despiselect:0000000000000018 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:372    .text.spiselect:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:378    .text.spiselect:0000000000000000 spiselect
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:424    .text.spiselect:000000000000002c $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:429    .text.send_cmd:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:435    .text.send_cmd:0000000000000000 send_cmd
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:594    .text.send_cmd:000000000000009c $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:600    .text.SPI_Timer_On:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:607    .text.SPI_Timer_On:0000000000000000 SPI_Timer_On
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:639    .text.SPI_Timer_On:0000000000000014 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:645    .text.SPI_Timer_Status:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:652    .text.SPI_Timer_Status:0000000000000000 SPI_Timer_Status
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:683    .text.SPI_Timer_Status:000000000000001c $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:689    .text.rcvr_datablock:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:695    .text.rcvr_datablock:0000000000000000 rcvr_datablock
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:778    .text.rcvr_datablock:0000000000000050 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:783    .text.USER_SPI_initialize:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:790    .text.USER_SPI_initialize:0000000000000000 USER_SPI_initialize
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1142   .text.USER_SPI_initialize:0000000000000160 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1149   .text.USER_SPI_status:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1156   .text.USER_SPI_status:0000000000000000 USER_SPI_status
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1185   .text.USER_SPI_status:0000000000000010 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1190   .text.USER_SPI_read:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1197   .text.USER_SPI_read:0000000000000000 USER_SPI_read
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1360   .text.USER_SPI_read:0000000000000084 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1366   .text.USER_SPI_write:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1373   .text.USER_SPI_write:0000000000000000 USER_SPI_write
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1575   .text.USER_SPI_write:00000000000000a8 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1581   .text.USER_SPI_ioctl:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1588   .text.USER_SPI_ioctl:0000000000000000 USER_SPI_ioctl
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1629   .text.USER_SPI_ioctl:0000000000000024 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:1634   .text.USER_SPI_ioctl:000000000000002e $t
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2080   .text.USER_SPI_ioctl:000000000000021c $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2108   .bss.pivot:0000000000000000 pivot
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2101   .bss.cmdBuffer:0000000000000000 cmdBuffer
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2128   .bss.token:0000000000000000 token
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2115   .bss.spiTimerTickDelay:0000000000000000 spiTimerTickDelay
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2122   .bss.spiTimerTickStart:0000000000000000 spiTimerTickStart
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2094   .bss.CardType:0000000000000000 CardType
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2095   .bss.CardType:0000000000000000 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2097   .bss.cmdBuffer:0000000000000000 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2104   .bss.pivot:0000000000000000 $d
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s 			page 57


C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2111   .bss.spiTimerTickDelay:0000000000000000 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2118   .bss.spiTimerTickStart:0000000000000000 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2129   .bss.token:0000000000000000 $d
C:\Users\Falle\AppData\Local\Temp\ccW6VUUz.s:2134   .data.Stat:0000000000000000 Stat

UNDEFINED SYMBOLS
HAL_SPI_TransmitReceive
hspi2
HAL_GetTick
HAL_GPIO_WritePin
